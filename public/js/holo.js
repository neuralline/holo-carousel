!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).holo=e.holo||{})}(this,(function(e){"use strict";var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function r(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var o,i={exports:{}};function n(){return o||(o=1,function(e){const r={reset:"[0m",magenta:"[35m",magentaBright:"[95m",red:"[31m",redBright:"[91m",green:"[32m",greenBright:"[92m",cyan:"[36m",cyanBright:"[96m",yellow:"[33m",yellowBright:"[93m",white:"[37m",whiteBright:"[97m",blue:"[34m",blueBright:"[94m",bgRed:"[41m",bgYellow:"[43m",bgBlue:"[44m",bold:"[1m",dim:"[2m",italic:"[3m",underline:"[4m"},o={DEBUG:["dim","cyan"],INFO:["blue","bold"],WARN:["yellowBright","bold"],ERROR:["redBright","bold"],SUCCESS:["greenBright","bold"]},i="undefined"!=typeof process&&process.versions&&process.versions.node,n="undefined"!=typeof window,a={DEBUG:0,INFO:1,WARN:2,ERROR:3,SUCCESS:1},s=(e,t,o)=>(s,l=!0,c=!1)=>{if(a[e]<a.DEBUG)return;const d=(u=e,m=s,`${l?`[${(new Date).toISOString()}]`:""} ${u}: ${m instanceof Error?`${m.message}\n${m.stack}`:"object"==typeof m?JSON.stringify(m,null,2):String(m)}`);var u,m;if(c||n){const t="ERROR"===e?"color: red; font-weight: bold":"WARN"===e?"color: orange; font-weight: bold":"SUCCESS"===e?"color: green; font-weight: bold":"INFO"===e?"color: blue":"color: gray";console[o](`%c${d}`,t)}else if(i){const e=t.reduce(((e,t)=>`${r[t]}${e}`),d);process.stdout.write(`${e}${r.reset}\n`)}},l={error:s("ERROR",o.ERROR,"error"),warn:s("WARN",o.WARN,"warn"),info:s("INFO",o.INFO,"log"),debug:s("DEBUG",o.DEBUG,"debug"),success:s("SUCCESS",o.SUCCESS,"log")},c=e=>{const t=new WeakMap;return(...r)=>{const o=r[0];return"object"==typeof o&&null!==o?(t.has(o)||t.set(o,e(...r)),t.get(o)):e(...r)}},d=(e,...t)=>t.reduce(((e,t)=>t(e)),e),u=(e,t)=>{if(Object.is(e,t))return!0;if("object"!=typeof e||"object"!=typeof t||null===e||null===t)return!1;if(Array.isArray(e)&&Array.isArray(t))return e.length===t.length&&e.every(((e,r)=>u(e,t[r])));const r=Object.keys(e),o=Object.keys(t);return r.length===o.length&&r.every((r=>u(e[r],t[r])))};"undefined"==typeof crypto&&(t.crypto={randomUUID:()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})),getRandomValues:e=>{if(null===e)return null;for(let t=0;t<e.length;t++)e[t]=Math.floor(256*Math.random());return e}});const m={RECUPERATION:6e4,MAX_TIMEOUT:Math.pow(2,31)-1},h="@cyre: System is offline",p="@cyre: System is online",f="@cyre: Welcome! How can I assist you?",g="Cannot add new channels: system is locked",y="Cannot add new subscribers: system is locked",v="Failed to prepare action: invalid configuration",b="Failed to execute action: runtime error",w="Action skipped: no payload changes detected",E="Failed to create channel: configuration error",S="Channel created successfully",k="Invalid channel data definition",T="Channel ID is required",I="Channel type is required",x="Invalid channel type specified",O="Invalid channel structure: check configuration",A="Invalid subscription parameters provided",C="Successfully subscribed to event",M="Invalid event handler provided",R="Subscription failed: check configuration",$="Call failed: system is offline",D="Call failed: invalid action ID",L="Call failed: action not responding",X="Dispatch failed: no subscriber found for this type",N="Q0.0U0.0A0.0N0.0T0.0U0.0M0 - I0.0N0.0C0.0E0.0P0.0T0.0I0.0O0.0N0.0S0-- ",H={MIN:50,BASE:200,MAX:1e3,RECOVERY:2e3},P={HIGH:.9,CRITICAL:.95},_={MAX_CPU:80,MAX_MEMORY:85,MAX_EVENT_LOOP:50,MAX_CALL_RATE:1e3},U={system:{cpu:0,memory:0,eventLoop:0,isOverloaded:!1},breathing:{breathCount:0,currentRate:H.BASE,lastBreath:Date.now(),stress:0,isRecuperating:!1,recuperationDepth:0,pattern:"NORMAL",nextBreathDue:Date.now()+H.BASE},performance:{callsTotal:0,callsPerSecond:0,lastCallTimestamp:Date.now(),activeQueues:{critical:0,high:0,medium:0,low:0,background:0},queueDepth:0},stress:{cpu:0,memory:0,eventLoop:0,callRate:0,combined:0},lastUpdate:Date.now(),inRecuperation:!1,hibernating:!1,activeFormations:0,isLocked:!1},Y=()=>{const e=new Map;return{get:t=>e.get(t),set:(t,r)=>{e.set(t,r),e.size>1e3&&Array.from(e.keys()).slice(0,e.size-1e3).forEach((t=>e.delete(t)))},forget:t=>e.delete(t),clear:()=>e.clear(),getAll:()=>Array.from(e.values()),size:()=>e.size}},q=Y();q.set("quantum",U);const B=c(((e,t)=>{const r=Math.min(1,(e.cpu||0)/(.7*_.MAX_CPU)),o=Math.min(1,(e.memory||0)/(.7*_.MAX_MEMORY)),i=Math.min(1,(e.eventLoop||0)/(.7*_.MAX_EVENT_LOOP)),n=Math.min(1,(t.callsPerSecond||0)/(.7*_.MAX_CALL_RATE)),a=Math.max(r,o,i,n);return{cpu:r,memory:o,eventLoop:i,callRate:n,combined:Math.min(1,(r+o+i+n+2*a)/6)}})),F=e=>{if(e>=P.CRITICAL)return H.RECOVERY;const t=Math.exp(e)-1;return Math.max(H.MIN,Math.min(H.MAX,H.BASE*(1+t)))},V={inRecuperation:!1,hibernating:!1,activeFormations:0,recuperationInterval:void 0,isLocked:!1,lock:()=>{V.isLocked=!0,V.update({isLocked:!0})},isSystemLocked:()=>V.isLocked,get:()=>{const e=q.get("quantum");return Object.freeze({...e,inRecuperation:V.inRecuperation,hibernating:V.hibernating,activeFormations:V.activeFormations})},update:e=>{const t={...q.get("quantum"),...e,lastUpdate:Date.now(),inRecuperation:e.inRecuperation??V.inRecuperation,hibernating:e.hibernating??V.hibernating,activeFormations:e.activeFormations??V.activeFormations};return(e.system||e.performance)&&(t.stress=B(t.system,t.performance)),q.set("quantum",t),t},updateBreath:e=>{const t=q.get("quantum"),r=B(e,t.performance),o=Date.now(),i={...t.breathing,breathCount:t.breathing.breathCount+1,lastBreath:o,stress:r.combined,currentRate:F(r.combined),nextBreathDue:o+F(r.combined),isRecuperating:r.combined>P.HIGH,recuperationDepth:Math.min(1,r.combined),pattern:r.combined>P.HIGH?"RECOVERY":"NORMAL"};return V.update({system:e,breathing:i,stress:r,inRecuperation:i.isRecuperating})},recordCall:(e="medium")=>{const t=q.get("quantum"),r=Date.now(),o=r-t.performance.lastCallTimestamp>=1e3?1:t.performance.callsPerSecond+1,i={...t.performance,callsTotal:t.performance.callsTotal+1,callsPerSecond:o,lastCallTimestamp:r,activeQueues:{...t.performance.activeQueues,[e]:t.performance.activeQueues[e]+1},queueDepth:t.performance.queueDepth+1};return V.update({performance:i})},isHealthy:()=>{const e=q.get("quantum");return!e.breathing.isRecuperating&&e.stress.combined<P.HIGH},shouldAllowCall:e=>{const t=q.get("quantum");return t.breathing.isRecuperating?"critical"===e:t.stress.combined<P.HIGH||"critical"===e||"high"===e},reset:()=>{V.inRecuperation=!1,V.hibernating=!1,V.activeFormations=0,V.isLocked=!1,q.set("quantum",U)},forget:e=>{q.forget(e)}},j=Y(),z=Y(),W=Y(),G=Y(),Q=Y(),Z=e=>{const t=Q.get(e);t?.intervalId&&clearInterval(t.intervalId),Q.forget(e),G.forget(e)},J=e=>{if(!e?.id)throw new Error("IO must have an id");try{const t={...e,timestamp:Date.now(),type:e.type||e.id};Z(e.id),j.set(e.id,t),Q.set(e.id,{lastExecutionTime:Date.now(),executionCount:0,errors:[]}),e.detectChanges&&G.set(e.id,e.payload),V.recordCall(e.priority?.level)}catch(t){throw l.error(`Failed to set IO: ${t instanceof Error?t.message:String(t)}`),t}},K=e=>j.get(e),ee=e=>(Z(e),j.forget(e)),te=()=>{j.getAll().forEach((e=>{e.id&&Z(e.id)})),G.clear(),Q.clear(),j.clear(),V.reset()},re=(e,t)=>{const r=G.get(e);return!u(t,r)},oe=e=>G.get(e),ie=e=>Q.get(e),ne=e=>{if(!e?.id||!e?.fn)throw new Error("Invalid subscriber format");z.set(e.id,e)},ae=e=>z.get(e),se=()=>z.clear(),le=e=>{e.id&&W.set(e.id,e)},ce=e=>W.get(e),de=e=>{const t=W.get(e);return t?.timeoutId&&clearTimeout(t.timeoutId),W.forget(e)},ue=()=>{W.getAll().forEach((e=>{e.timeoutId&&clearTimeout(e.timeoutId)})),W.clear()},me=()=>W.getAll(),he=()=>W.getAll().filter((e=>"active"===e.status)),pe=e=>e.type&&e.id?{...e,ok:!0,status:"active"}:{...e,ok:!1,done:!1,status:"error",error:"Missing required fields: type or id"},fe=e=>e.detectChanges?re(e.id,e.payload)?e:{...e,ok:!0,done:!0,status:"skipped",skipped:!0,skipReason:w}:e,ge=e=>{if(e.skipped||"error"===e.status)return e;try{const t=ae(e.id);if(!t)throw new Error("No subscriber found");const r=t.fn(e.payload);return r&&"object"==typeof r&&"id"in r?{...e,ok:!0,done:!0,status:"completed",intraLink:{id:r.id,payload:r.payload}}:{...e,ok:!0,done:!0,status:"completed"}}catch(t){return l.error(`${b}: ${e}, Error: ${t instanceof Error?t.message:String(t)}`),{...e,ok:!1,done:!1,status:"error",error:t instanceof Error?t.message:String(t)}}},ye=(e,t)=>{if(!e)return l.error(v),{id:"",type:"",ok:!1,done:!1,status:"error",error:v};try{return d((e=>{try{if(!e)throw new Error(v);return{...e,ok:!0,done:!1,status:"pending",timestamp:Date.now()}}catch(t){return{id:"",type:"",ok:!1,done:!1,status:"error",error:v}}})(e),pe,fe,ge,(e=>{return"error"===e.status?e:((t=e).log&&("error"===t.status?l.error(t):(t.status,l.info(t))),t);var t}),(e=>{return"error"===e.status?e:((t=e).ok&&!t.skipped&&J({...t,timestamp:Date.now()}),t);var t}))}catch(r){return l.error(`Action processing failed: ${r}`),{...e,ok:!1,done:!1,status:"error",error:r instanceof Error?r.message:String(r)}}},ve=c((e=>e?e.id?e.type||e.id?e.type&&"string"!=typeof e.type?{isValid:!1,error:x}:{isValid:!0}:{isValid:!1,error:I}:{isValid:!1,error:T}:{isValid:!1,error:O})),be=(e,t)=>{try{if(!("object"==typeof(i=e)&&null!==i&&"id"in i&&"string"==typeof i.id&&i.id.length>0))return l.error(O),{ok:!1,message:O};const n=ve(e);if(!n.isValid)return l.error(n.error),{ok:!1,message:n.error};if(r=e,(o=t)&&!Object.entries(o).filter((([e,t])=>t(void 0).required)).map((([e])=>e)).every((e=>e in r)))return l.error(k),{ok:!1,message:k};const a=((e,t)=>{try{const r={...e},o=[];for(const[i,n]of Object.entries(e)){const e=t[i];if(!e){r[i]=n;continue}const a=e(n);if(!a.ok){if(a.required)return{ok:!1,message:`Required field '${i}' validation failed: ${a.message}`,payload:r};o.push(`${i}: ${a.message}`)}r[i]=a.payload}for(const[i,n]of Object.entries(t))if(n(void 0).required&&!(i in e))return{ok:!1,message:`Missing required field: ${i}`,payload:r};return o.length>0?{ok:!1,message:o.join("; "),payload:r}:{ok:!0,payload:r}}catch(r){const e=r instanceof Error?r.message:String(r);return l.error(`Data definition processing failed: ${e}`),{ok:!1,message:k}}})(e,t);if(!a.ok)return a;const s=(e=>{const t=Date.now();return{...e,type:e.type||e.id,timestamp:t,interval:e.interval||0,timeOfCreation:e.timeOfCreation||t}})({...a.payload,id:e.id});return l.success(S),{ok:!0,message:S,payload:s}}catch(n){const e=n instanceof Error?n.message:String(n);return l.error(`Channel processing failed: ${e}`),{ok:!1,message:E}}var r,o,i},we=(e,t)=>{try{const i=(o=t,(r=e)&&"string"==typeof r?"function"!=typeof o?{ok:!1,message:M,error:{code:"INVALID_HANDLER",message:"Event handler must be a function"}}:{ok:!0,message:C,subscriber:{id:r.trim(),fn:o}}:{ok:!1,message:x,error:{code:"INVALID_TYPE",message:`Type must be a non-empty string, received: ${r}`}});if(!i.ok||!i.subscriber)return l.error(i.error||i.message),{ok:!1,message:i.message};const{subscriber:n}=i;if(ae(n.id)){const e=`DUPLICATE LISTENER DETECTED: Channel "${n.id}" already has a listener attached!`;l.warn(e),"undefined"!=typeof console&&console.warn&&(console.warn(`ðŸ”¥ ${e}`),console.warn("This may cause unexpected behavior if the previous listener is still active."),console.warn("Consider using cyre.forget() to remove previous listeners before adding new ones."))}return ne(n),l.info(`${C}: ${n.id}`),{ok:!0,message:`${C}: ${n.id}`}}catch(i){const e=i instanceof Error?i.message:String(i);return l.error(`Failed to add subscriber: ${e}`),{ok:!1,message:R}}var r,o},Ee=(e,t)=>V.isSystemLocked()?(l.error(y),{ok:!1,message:y}):Array.isArray(e)?(e=>{try{const t=e.map((e=>{if(!e.id||!e.fn)return l.error(`Invalid subscriber format: ${JSON.stringify(e)}`),!1;try{return ne(e),!0}catch(t){return l.error(`Failed to add subscriber ${e.id}: ${t}`),!1}})).filter(Boolean).length,r=e.length;return 0===t?{ok:!1,message:`Failed to add any subscribers out of ${r}`}:{ok:!0,message:`Successfully added ${t} out of ${r} subscribers`}}catch(t){const e=t instanceof Error?t.message:String(t);return l.error(`Batch subscription failed: ${e}`),{ok:!1,message:R}}})(e):"string"==typeof e&&t?we(e,t):(l.error(A),{ok:!1,message:A}),Se=async e=>{if(!e||!e.id)return;const t=performance.now(),r=ce(e.id);var o;if(r&&r.isActive)try{await e.callback();const i=performance.now()-t;r.metrics.totalExecutions++,r.metrics.successfulExecutions++,r.metrics.lastExecutionTime=i,r.metrics.longestExecutionTime=Math.max(r.metrics.longestExecutionTime,i),r.metrics.shortestExecutionTime=Math.min(r.metrics.shortestExecutionTime,i),r.metrics.averageExecutionTime=(r.metrics.averageExecutionTime*(r.metrics.totalExecutions-1)+i)/r.metrics.totalExecutions,r.executionCount++,r.lastExecutionTime=Date.now(),"number"==typeof r.repeat&&r.repeat>0&&(r.repeat=r.repeat-1),le(r),!0===(o=r.repeat)||o===1/0||"number"==typeof o&&o>0?Te(r):de(r.id)}catch(i){const t=ce(e.id);t&&(t.metrics.failedExecutions++,le(t)),l.error(`Timer execution failed: ${i}`)}},ke=e=>{if(!e||!e.id)return;const t=e.duration>m.RECUPERATION?m.RECUPERATION:Math.max(e.duration/10,1e3);let r,o=Date.now();const i=()=>{const n=ce(e.id);if(!n||!n.isActive)return void clearTimeout(r);const a=Date.now(),s=V.get(),l=1+(s.stress?.combined||0);if(a-o>t||Math.abs(l-1)>.1){const e=n.originalDuration-n.executionCount*m.MAX_TIMEOUT;n.duration=Math.min(e,m.MAX_TIMEOUT)*l,n.nextExecutionTime=a+n.duration,le(n),o=a}s.hibernating||"active"!==n.status||(r=setTimeout(i,t),n.recuperationInterval=r,le(n))};return r=setTimeout(i,t),r},Te=e=>{if(!e||!e.id)return;const t=V.get();if(t.hibernating)return;const r=Date.now(),o=1+(t.stress?.combined||0),i=ce(e.id);if(!i||!i.isActive)return;if(i.executionCount>1e4)return l.error("Maximum execution count exceeded"),void de(i.id);let n=i.duration*o;if(i.isInRecuperation){const e=i.originalDuration-i.executionCount*m.MAX_TIMEOUT;n=Math.min(e*o,m.MAX_TIMEOUT),i.duration=n,i.duration>m.RECUPERATION&&(i.recuperationInterval&&clearTimeout(i.recuperationInterval),i.recuperationInterval=ke(i)),e<=m.MAX_TIMEOUT&&(i.isInRecuperation=!1)}else i.duration=n;i.nextExecutionTime=r+i.duration,i.timeoutId&&clearTimeout(i.timeoutId);const a="undefined"!=typeof process&&"test"===process.env.NODE_ENV;i.timeoutId=a?setTimeout((()=>Se(i)),i.duration):i.duration<25?((e,t)=>{if("undefined"!=typeof process&&"test"===process.env.NODE_ENV)return setTimeout(e,t);const r=process.hrtime(),o=()=>{const[i,n]=process.hrtime(r),a=1e3*i+n/1e6;if(a>=t)e();else{const e=t-a;e<1?setImmediate(o):e<25?setTimeout(o,0):setTimeout(o,Math.floor(e/2))}};return setTimeout(o,0)})((()=>Se(i)),i.duration):setTimeout((()=>Se(i)),i.duration),le(i)},Ie=(e,t,r,o=crypto.randomUUID())=>{try{const n=((e,t,r,o)=>{if(!e||"number"!=typeof t||"function"!=typeof r)throw new Error("Invalid formation parameters");const i=Date.now(),n=t>=m.MAX_TIMEOUT,a=V.get(),s=1+(a.stress?.combined||0),l={id:e,startTime:i,duration:n?m.MAX_TIMEOUT:t*s,originalDuration:t,callback:r,repeat:o,executionCount:0,lastExecutionTime:0,nextExecutionTime:i+(n?m.MAX_TIMEOUT:t*s),isInRecuperation:n,status:"active",isActive:!0,metrics:{totalExecutions:0,successfulExecutions:0,failedExecutions:0,averageExecutionTime:0,lastExecutionTime:0,longestExecutionTime:0,shortestExecutionTime:1/0,missedExecutions:0}};return n&&(l.recuperationInterval=ke(l)),l})(o,"number"==typeof e?e:24*((i=e).days||0)*60*60*1e3+60*(i.hours||0)*60*1e3+60*(i.minutes||0)*1e3+1e3*(i.seconds||0)+(i.milliseconds||0),t,r);return le(n),Te(n),{kind:"ok",value:n}}catch(n){return{kind:"error",error:n instanceof Error?n:new Error("Timer creation failed")}}var i},xe=e=>{const t=ce(e);t?.timeoutId&&clearTimeout(t.timeoutId),t?.recuperationInterval&&clearTimeout(t.recuperationInterval),de(e)},Oe=e=>{if(e){const t=ce(e);t&&(t.timeoutId&&clearTimeout(t.timeoutId),t.recuperationInterval&&clearTimeout(t.recuperationInterval),t.status="paused",t.isActive=!1,le(t))}else me().forEach((e=>{e.timeoutId&&clearTimeout(e.timeoutId),e.recuperationInterval&&clearTimeout(e.recuperationInterval),e.status="paused",e.isActive=!1,le(e)}))},Ae=e=>{if(!V.get().hibernating)if(e){const t=ce(e);t&&"paused"===t.status&&(t.status="active",t.isActive=!0,le(t),Te(t))}else me().forEach((e=>{"paused"===e.status&&(e.status="active",e.isActive=!0,le(e),Te(e))}))},Ce=()=>{V.update({hibernating:!0}),me().forEach((e=>{e.timeoutId&&clearTimeout(e.timeoutId),e.recuperationInterval&&clearTimeout(e.recuperationInterval)})),ue()},Me={id:(e="")=>"string"==typeof e?{ok:!0,payload:e}:{ok:!1,payload:null,message:`action.id must be a string. Received '${e}'`,required:!0},type:(e="")=>"string"==typeof e?{ok:!0,payload:e}:{ok:!1,payload:null,message:`action.type must be a string. Received '${e}'`,required:!0},payload:(e=null)=>({ok:!0,payload:e}),interval:(e=0)=>Number.isInteger(e)?{ok:!0,payload:e}:{ok:!1,payload:0,message:`'${e}' invalid action.interval value`,required:!1},timeOfCreation:(e=0)=>Number.isInteger(e)?{ok:!0,payload:e}:{ok:!1,payload:0,message:`'${e}' invalid @cyre.call time of creation value`,required:!0},repeat:(e=0)=>"number"==typeof e||"boolean"==typeof e||e===1/0?{ok:!0,payload:e}:{ok:!1,payload:0,message:`'${e}' invalid action.repeat value. Expected number, boolean, or Infinity.`,required:!1},message:(e="")=>"string"==typeof e?{ok:!0,payload:e}:{ok:!1,payload:"",message:`action.message must be a string. Received '${e}'`,required:!1},group:(e="")=>"string"==typeof e?{ok:!0,payload:e}:{ok:!1,payload:null,message:`'${e}' invalid action.group value`,required:!1},callback:(e="")=>"string"==typeof e?{ok:!0,payload:e}:{ok:!1,payload:null,message:`'${e}' invalid action.callback value`,required:!1},log:(e=!1)=>"boolean"==typeof e?{ok:!0,payload:e}:{ok:!1,payload:!1,message:`'${e}' invalid action.log value`,required:!1},middleware:(e="")=>"string"==typeof e?{ok:!0,payload:e}:{ok:!1,payload:null,message:`'${e}' invalid action.middleware value`,required:!1},throttle:(e=0)=>Number.isInteger(e)?{ok:!0,payload:e}:{ok:!1,payload:100,message:`'${e}'  action.throttle value must be a number`,required:!1},debounce:(e=0)=>Number.isInteger(e)?{ok:!0,payload:e}:{ok:!1,payload:100,message:`'${e}'  action.debounce value must be a number`,required:!1},at:(e=0)=>({ok:!1,payload:e,message:`'${e}'  action.at is an experimental feature, not applied yet`,required:!1})},Re=function(e=crypto.randomUUID()){let t=!1;const r=async(e,t,r)=>{const o=e.repeat,n=Ie(t,(async()=>{V.isHealthy()&&await i({...e,timeOfCreation:performance.now(),payload:r??e.payload})}),o,e.id);return"error"===n.kind?{ok:!1,payload:null,message:n.error.message}:{ok:!0,payload:null,message:`Scheduled with breathing-adjusted interval: ${Math.round(t)}ms. First execution will occur after this interval.`}},o=async(e,t)=>{const r=e.priority?.level||"medium";if(!V.shouldAllowCall(r)){const{stress:e}=V.get();return{ok:!1,payload:null,message:`System under high stress (${(100*e.combined).toFixed(1)}%). Try later.`}}return n(e,t)},i=async e=>{if(!e?.type)throw new Error("Invalid IO object");try{const r=ae(e.type)||ae(e.id);if(!r){const t=`${X} ${e.type}`;return l.error(t),{ok:!1,payload:null,message:t}}const o=performance.now(),i=ye({...e},r.fn);if(e.log&&l.info({...i,executionTime:performance.now()-o,timestamp:Date.now()}),i?.intraLink)try{const{id:e,payload:t}=i.intraLink;await a(e,t)}catch(t){l.error(`Linked action error: ${t}`)}return{ok:!0,payload:i,message:f}}catch(t){const e=t instanceof Error?t.message:String(t);return l.error(`Dispatch error: ${e}`),{ok:!1,payload:null,message:`Dispatch error: ${e}`}}},n=async(e,t)=>{try{if(e.throttle){const t=Date.now()-(ie(e.id)?.lastExecutionTime||0);if(t<e.throttle)return{ok:!1,payload:null,message:`Throttled: ${e.throttle-t}ms remaining`}}if(e.debounce){e.debounceTimerId&&(xe(e.debounceTimerId),e.debounceTimerId=void 0);const r=`${e.id}-debounce-${Date.now()}`,o=t??e.payload,n=Ie(e.debounce,(async()=>{await i({...e,timeOfCreation:performance.now(),payload:o,debounceTimerId:void 0}),V.recordCall(e.priority?.level)}),!1,r);return"ok"===n.kind?(e.debounceTimerId=r,J(e),{ok:!0,payload:null,message:`Debounced: will execute after ${e.debounce}ms`}):{ok:!1,payload:null,message:`Failed to setup debounce: ${n.error.message}`}}const r=await i({...e,timeOfCreation:performance.now(),payload:t??e.payload});return V.recordCall(e.priority?.level),r}catch(r){return{ok:!1,payload:null,message:`Call failed: ${r instanceof Error?r.message:String(r)}`}}},a=async(e,i)=>{if(t)return{ok:!1,message:$,payload:null};if(!e?.trim())return{ok:!1,message:D,payload:null};const a=K(e.trim());return a?(async(e,t)=>{if(!e)return{ok:!1,payload:null,message:"Invalid action"};const{breathing:i,stress:a}=V.get();if(i.isRecuperating&&"critical"!==e.priority?.level)return{ok:!1,payload:null,message:`System recuperating (${(100*i.recuperationDepth).toFixed(1)}% depth). Try later.`};if(e.interval){const o=e.interval*(1+a.combined);return r(e,o,t)}return a.combined>=P.HIGH?o(e,t):n(e,t)})(a,i):{ok:!1,payload:null,message:`${L}: ${e}`}},s=()=>{if(!t)try{me().forEach((e=>{e.timeoutId&&clearTimeout(e.timeoutId)})),Ce(),se(),te(),V.reset(),t=!0,"undefined"!=typeof process&&process.exit&&process.exit(0)}catch(e){l.error(`Failed to shutdown gracefully: ${e}`),"undefined"!=typeof process&&process.exit&&process.exit(1)}};return"undefined"!=typeof window?window.addEventListener("beforeunload",s):(process.on("SIGINT",s),process.on("SIGTERM",s),process.on("uncaughtException",(e=>{console.error("Uncaught Exception:",e),s()}))),{initialize:()=>(t=!1,Ie(H.BASE,(async()=>{const e=V.get();V.updateBreath({cpu:e.system.cpu,memory:e.system.memory,eventLoop:e.system.eventLoop,isOverloaded:e.system.isOverloaded})}),!0),Ae(),console.log("%c"+N,"background: rgb(151, 2, 151); color: white; display: block;"),{ok:!0,payload:200,message:f}),call:a,action:e=>{if(t)l.error(h);else if(V.isLocked)l.error(g);else try{if(Array.isArray(e))e.forEach((e=>{const t=be({...e,type:e.type||e.id},Me);t.ok&&t.payload&&J(t.payload)}));else{const t=be({...e,type:e.type||e.id},Me);t.ok&&t.payload&&J(t.payload)}}catch(r){l.error(`Action registration failed: ${r}`)}},on:Ee,shutdown:s,lock:()=>t?{ok:!1,message:$,payload:null}:(V.isLocked=!0,l.info("Cyre system locked - no new channels or subscribers can be added"),{ok:!0,message:"System locked successfully",payload:null}),status:()=>(t?l.info({ok:!0,message:h}):l.info({ok:!0,message:p}),t),forget:e=>t?(l.error($),!1):(Oe(e),ee(e)),get:e=>{if(!t)return K(e);l.error($)},pause:e=>{if(t)return void l.error($);Oe(e);const r=me();if(e){const t=ce(e);t&&le({...t,status:"paused"})}else r.forEach((e=>{e&&le({...e,status:"paused"})}))},resume:e=>{if(t)return void l.error($);Ae(e);const r=me();if(e){const t=ce(e);t&&le({...t,status:"active"})}else r.forEach((e=>{e&&le({...e,status:"active"})}))},hasChanged:(e,r)=>t?(l.error($),!1):re(e,r),getPreviousPayload:e=>{if(!t)return oe(e);l.error($)},getBreathingState:()=>V.get().breathing,getPerformanceState:()=>{const e=V.get();return{totalProcessingTime:0,totalCallTime:0,totalStress:e.stress.combined,stress:e.stress.combined}},getMetrics:e=>t?{hibernating:!0,activeFormations:0,inRecuperation:!1,breathing:V.get().breathing,formations:[]}:{hibernating:!1,activeFormations:he().length,inRecuperation:!1,breathing:V.get().breathing,formations:me().filter((t=>t.id===e)).map((e=>({...e,breathingSync:1})))}}},$e=Re("quantum-inceptions");$e.initialize(),e.Cyre=Re,e.CyreLog=l,e.cyre=$e,e.default=$e,e.isEqual=u,e.memoize=c,e.pipe=d,e.tryCatch=async e=>{try{return{kind:"ok",value:await e()}}catch(t){return{kind:"error",error:t instanceof Error?t:new Error(String(t))}}},e.version="3.1.2",Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}(i.exports)),i.exports}const a=r(n());class s{constructor(){this.id=0,this.virtual={id:this.id||0,carousel:{},container:{},io:{},title:null,description:null,duration:600,transitionTiming:"cubic- bezier(0.215, 0.61, 0.355, 1)",transformX:0,transformY:0,transformZ:0,numberOfSlots:0,endOfSlide:0,item:{max:8}},this.shadow={carousel:{},container:{}},this.virtual.io={id:this.id||0,enabled:1,wheel:0,controller:0,drag:1,swipe:1,snap:3,focus:1,animate:1,animateDirection:1,duration:0,loop:200,orientation:0,active:!0,onClick:!0,onDoubleClick:!0},this.style={}}}class l extends s{constructor(e,t={}){super(),e||console.error("@Holo: Oh putain` no slide"),this.id=e.id||"OhPutain-"+performance.now(),this.shadow.carousel=e,this.shadow.container=this.shadow.carousel.getElementsByClassName("holo-container")[0]||0,this.shadow.container?this.initializeHolo():console.error("@Holo : Oh Putain` holo-container not found : ",this.id)}initializeHolo(){if(this.shadow.carousel.width=this.shadow.carousel.clientWidth||0,!this.shadow.container.children.length)return this.virtual.noOfChildren=0,console.error("@Holo: Oh Putain`  holo-container is empty  : ",this.id);this.virtual.id=this.id,this.virtual.noOfChildren=this.shadow.container.children.length,this.virtual.carousel.width=this.shadow.container.clientWidth,this.virtual.carousel.height=this.shadow.container.clientHeight,this.virtual.startNumber=0,this.virtual.endOfSlidePosition=0,this.virtual.item.min=1}get getVirtual(){return{...this.virtual}}get getShadow(){return this.shadow}get getState(){return{virtual:this.getVirtual,shadow:this.getShadow}}get getDimensions(){return{car:{w:this.shadow.carousel.width,h:this.shadow.carousel.height},con:{w:this.shadow.container.width,h:this.shadow.container.height,x:this.shadow.transformX,y:this.shadow.transformY,z:this.shadow.transformZ}}}set setState(e){if(!e)return!1;this.virtual={...this.virtual,...e},this.shadow.container.style.transform=`translate3d(${this.virtual.transformX}px, ${this.virtual.transformY}px, ${this.virtual.transformZ}px)`}set setDimension(e){if(!e)return!1;this.virtual={...this.virtual,...e,...e.io},!this.virtual.io.orientation&&(this.shadow.carousel.style.width=this.virtual.carousel.width+"px"),this.virtual.io.orientation&&(this.shadow.carousel.style.height=this.virtual.carousel.height+"px")}set updateStyle(e=0){e?(this.shadow.container.style.transitionDuration=this.virtual.duration+"ms",this.shadow.container.style.transitionTimingFunction=this.virtual.transitionTiming):(this.shadow.container.style.transitionDuration="0ms",this.shadow.container.style.transitionTimingFunction="linear")}}const c={},d=(e,t)=>Math.round(e/t)*t,u=([e,t])=>{t.transformX=-Math.abs(e.offsetLeft),a.call("SNAP",t),e.classList.add("active")},m=e=>{if(1!==e.endOfSlide)return e.transformX+=e.carousel.width||0,e.transformY+=e.carousel.height||0,a.call("SNAP",e)},h=e=>{if(-1!==e.endOfSlide)return e.transformX-=e.carousel.width||0,e.transformY-=e.carousel.height||0,a.call("SNAP",e)},p=e=>(e.transformX=0,e.transformY=0,e.endOfSlide=1,a.call("SNAP",e)),f=e=>(e.transformX=e.endOfSlidePosition,e.transformY=e.endOfSlidePosition,e.endOfSlide=-1,a.call("SNAP",e)),g=e=>-1===e.endOfSlide?a.call("firstSlide",e):a.call("nxtSlide",e),y=e=>1===e.endOfSlide?a.call("lastSlide",e):a.call("prvSlide",e),v=e=>{a.call("AnimateForward")},b=(e,t)=>{e.preventDefault(),console.log("wheeler",t);const r=c[t].getVirtual;e.deltaY<0?a.call("prvSlide",r):e.deltaY>0&&a.call("nxtSlide",r)},w=e=>(e.transformY=e.io.snap?d(e.transformY,e.item.height):e.transformY,e.transformX=0,e.transformY>=0?(e.transformY=0,e.endOfSlide=1):e.transformY<=e.endOfSlidePosition?(e.transformY=e.endOfSlidePosition,e.endOfSlide=-1):e.endOfSlide=0,e);const E=new class{constructor(){this.positionX=0,this.positionY=0,this.pressed=0,this.virtual={},this.multiplier=1.482,this.touch={start:"mousedown",move:"mousemove",end:"mouseup",enter:"mouseenter"},this.targetHoloComponent=0}_touchStart(e=window.event,t=0){return!t||this.pressed?console.error("Holo touch : not my business"):(this.TouchStartTimeStamp=performance.now(),this.virtual=c[t].getVirtual,this.pressed=1,this.positionX=e.clientX||e.touches[0].clientX,this.positionY=e.clientY||e.touches[0].clientY,this.id=this.virtual.id,this.currentX=e.clientX||e.touches[0].clientX,this.currentY=e.clientY||e.touches[0].clientY,this.snapShotWidth=this.virtual.transformX||0,this.snapShotHeight=this.virtual.transformY||0,this.virtual.io.orientation?(this._dragScrollVertical(e),e.preventDefault()):(this._dragScrollHorizontal(e),e.preventDefault()),c[this.id].updateStyle=0)}_dragScrollHorizontal(e){if(!this.pressed)return{ok:!1,data:"not active"};var t;this.distance=this.positionX-this.currentX,this.virtual.transformX=this.snapShotWidth-this.distance*this.multiplier||0,c[this.id].setState=((t=this.virtual).transformY=0,t.transformX>=0?t.transformX=0:t.transformX<=t.endOfSlidePosition&&(t.transformX=t.endOfSlidePosition),t),requestAnimationFrame(this._dragScrollHorizontal.bind(this))}_dragScrollVertical(e){if(!this.pressed)return{ok:!1,data:"not active"};this.distance=this.positionY-this.currentY,this.virtual.transformY=this.snapShotHeight-this.distance*this.multiplier||0,c[this.id].setState={...w(this.virtual)},requestAnimationFrame(this._dragScrollVertical.bind(this))}_touchEnd(e){if(!this.pressed)return{ok:!1,data:"not active"};const t=performance.now();e.preventDefault(),this.pressed=0;const r=t-this.TouchStartTimeStamp,o=((e,t)=>e/t)(this.distance,r);if(o>1.2)a.call("nxtSlide",this.virtual);else if(o<-1.2)a.call("prvSlide",this.virtual);else{if(!(e=>e<250?1:0)(r))return a.call("SNAP",this.virtual);this.focus(e)}}focus(e){return!!e.target.closest("li.holo")&&(this.targetHoloComponent&&this.targetHoloComponent.classList.remove("active"),this.targetHoloComponent=e.target.closest("li.holo"),a.call("activate",[this.targetHoloComponent,this.virtual]))}},S=(e,t)=>{c[e.id]=new l(e,t),((e,t)=>{if(!e)return console.error("@Holo : Major malfunction!");a.action([{id:"Animate",payload:e,interval:5e3,repeat:!0,log:!1},{id:"AnimateBackward",payload:e,interval:e.io.duration,repeat:e.io.loop,log:!1},{id:"AnimateForward",payload:e,interval:e.io.duration,repeat:e.io.loop,log:!1},{id:"SNAP",payload:e},{id:"prvSlide",payload:e},{id:"nxtSlide",payload:e},{id:"lastSlide",payload:e},{id:"firstSlide",payload:e},{id:"activate",payload:e}]),e.io.enabled&&(e.io.drag&&t.container.addEventListener("mousedown",(t=>{t.preventDefault(),E._touchStart(t,e.id)})),e.io.drag&&t.container.addEventListener("touchstart",(t=>{t.preventDefault(),E._touchStart(t,e.id)})),e.io.wheel&&t.carousel.addEventListener("wheel",(t=>{b(t,e.id)})),e.io.animate&&a.call("Animate",e),t.container.addEventListener("resize",(()=>{a.call("refresh carousel",{virtual:e,shadow:t})}),!1)),a.call("refresh carousel",{virtual:e,shadow:t})})(c[e.id].getVirtual,c[e.id].getShadow)},k=e=>{console.log("@holo holo auto activated :",e);const t=document.getElementsByClassName(e);if(!t.length)return console.log("@Holo : carousel structure not found");for(let r of t)S(r,{})},T=(()=>{a.on("refresh carousel",(t=>{const{virtual:r,shadow:o}=t;if(!r.id)return console.error("Holo carousel refresh error ",r.id);o.container.setAttribute("style","");const{height:i,width:n}=(e=>{if(!e)return 0;const t={};t.width=e.offsetWidth,t.height=e.offsetHeight;const r=window.getComputedStyle(e,null);return t.width+=parseInt(r.marginLeft)+parseInt(r.marginRight),t.height+=parseInt(r.marginTop)+parseInt(r.marginBottom),t})(o.container.children[0]);r.item.height=i,r.item.width=n,r.numberOfSlots=e(o.carousel.parentNode.clientWidth,r.item.width,r.item.max)||1;const s=r.numberOfSlots*r.item.width,l=o.carousel.clientWidth,d=o.container.children.length*r.item.width,u=o.container.clientWidth||d;return r.carousel.width=s||l,r.carousel.height=r.item.height||o.carousel.clientHeight,r.container.width=r.io.orientation?o.carousel.width:u,r.container.height=o.container.clientHeight||r.item.height||0,r.endOfSlidePosition=r.io.orientation?-Math.abs(r.container.height-r.carousel.height):-Math.abs(r.container.width-r.carousel.width),c[r.id].setDimension={...r},a.call("SNAP",r)})),a.on("SNAP",(e=>e.id?(c[e.id].updateStyle=1,e=e.io.orientation?w(e):(e=>(e.transformX=e.io.snap?d(e.transformX,e.item.width):e.transformX,e.transformY=0,e.transformX>=0?(e.transformX=0,e.endOfSlide=1):e.transformX<=e.endOfSlidePosition?(e.transformX=e.endOfSlidePosition,e.endOfSlide=-1):e.endOfSlide=0,e))(e),c[e.id].setState={...e}):{id:"holo-error",payload:"Holo snap error"}));const e=(e,t,r)=>{let o=Math.floor(e/t);return r&&o>r?r||1:o||1},t=e=>{console.log("shaking")};document.addEventListener("DOMContentLoaded",(()=>{}),!1);const r=()=>{for(let e in c)a.call("refresh carousel",c[e].getState)};return window.addEventListener("resize",(()=>{a.call("refresh screen")}),!1),window.onload=()=>{},{TOUCH:E,INIT:(e="holo-carousel")=>{console.log("%c HOLO - Initiating holo v2.3.4 ","background: #022d5f; color: white; display: block;"),document.addEventListener("mousemove",(e=>{E.pressed&&(E.currentX=e.clientX,E.currentY=e.clientY)})),document.addEventListener("mouseup",(e=>{e.preventDefault(),E.pressed&&E._touchEnd(e)})),document.addEventListener("touchmove",(e=>{E.pressed&&(E.currentX=e.touches[0].clientX,E.currentY=e.touches[0].clientY)})),document.addEventListener("touchend",(e=>{E.pressed&&E._touchEnd(e)})),a.on("AnimateForward",g),a.on("AnimateBackward",y),a.on("Animate",v),a.on("nxtSlide",h),a.on("prvSlide",m),a.on("firstSlide",p),a.on("lastSlide",f),a.on("bringToFocus",E.focus),a.on("wheeler",b),a.on("activate",u),a.action([{id:"refresh screen",debounce:300},{id:"refresh carousel"},{id:"holo-error",log:!0}]),a.on("SHAKE",t),a.on("refresh screen",r)},BUILD:S,AUTO:k,carousel:(e,t={})=>{const r=c[e].virtual;for(const o in t)r.io[o]&&(r.io[o]=t[o]);return{ok:!0,data:r.io}},refresh:r,dimensions:e=>c[e].getDimensions}})();"undefined"!=typeof window&&(window.Holo=T),e.default=T,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
//# sourceMappingURL=holo.js.map
