!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).Holo=t()}(this,(function(){"use strict";var e,t={exports:{}};function o(){return e||(e=1,function(e){const t={reset:"[0m",magenta:"[35m",magentaBright:"[95m",red:"[31m",redBright:"[91m",green:"[32m",greenBright:"[92m",cyan:"[36m",cyanBright:"[96m",yellow:"[33m",yellowBright:"[93m",white:"[37m",whiteBright:"[97m",blue:"[34m",blueBright:"[94m",bgRed:"[41m",bgYellow:"[43m",bgBlue:"[44m",bold:"[1m",dim:"[2m",italic:"[3m",underline:"[4m"},o={DEBUG:["dim","cyan"],INFO:["blue","bold"],WARN:["yellowBright","bold"],ERROR:["redBright","bold"],SUCCESS:["greenBright","bold"]},r="undefined"!=typeof process&&process.versions&&process.versions.node,i="undefined"!=typeof window,n={DEBUG:0,INFO:1,WARN:2,ERROR:3,SUCCESS:1},a=(e,o,a)=>(s,d=!0,c=!1)=>{if(n[e]<n.DEBUG)return;const l=(u=e,h=s,`${d?`[${(new Date).toISOString()}]`:""} ${u}: ${h instanceof Error?`${h.message}\n${h.stack}`:"object"==typeof h?JSON.stringify(h,null,2):String(h)}`);var u,h;if(c||i){const t="ERROR"===e?"color: red; font-weight: bold":"WARN"===e?"color: orange; font-weight: bold":"SUCCESS"===e?"color: green; font-weight: bold":"INFO"===e?"color: blue":"color: gray";console[a](`%c${l}`,t)}else if(r){const e=o.reduce(((e,o)=>`${t[o]}${e}`),l);process.stdout.write(`${e}${t.reset}\n`)}},s={error:a("ERROR",o.ERROR,"error"),warn:a("WARN",o.WARN,"warn"),info:a("INFO",o.INFO,"log"),debug:a("DEBUG",o.DEBUG,"debug"),success:a("SUCCESS",o.SUCCESS,"log")},d=e=>{const t=new WeakMap;return(...o)=>{const r=o[0];return"object"==typeof r&&null!==r?(t.has(r)||t.set(r,e(...o)),t.get(r)):e(...o)}},c=(e,...t)=>t.reduce(((e,t)=>t(e)),e),l=(e,t)=>{if(Object.is(e,t))return!0;if("object"!=typeof e||"object"!=typeof t||null===e||null===t)return!1;if(Array.isArray(e)&&Array.isArray(t))return e.length===t.length&&e.every(((e,o)=>l(e,t[o])));const o=Object.keys(e),r=Object.keys(t);return o.length===r.length&&o.every((o=>l(e[o],t[o])))},u={RECUPERATION:6e4,MAX_TIMEOUT:Math.pow(2,31)-1},h="@cyre: System is offline",m="@cyre: System is online",f="@cyre: Welcome! How can I assist you?",g="Failed to prepare action: invalid configuration",p="Failed to execute action: runtime error",y="Action skipped: no payload changes detected",v="Failed to create channel: configuration error",E="Channel created successfully",S="Invalid channel data definition",I="Channel ID is required",w="Channel type is required",C="Invalid channel type specified",b="Invalid channel structure: check configuration",R="Invalid subscription parameters provided",O="Subscriber exists - updating configuration",T="Successfully subscribed to event",_="Invalid event handler provided",L="Subscription failed: check configuration",A="Call failed: system is offline",$="Call failed: invalid action ID",N="Call failed: action not responding",M="Dispatch failed: no subscriber found for this type",x="Q0.0U0.0A0.0N0.0T0.0U0.0M0 - I0.0N0.0C0.0E0.0P0.0T0.0I0.0O0.0N0.0S0-- ",D={MIN:50,BASE:200,MAX:1e3,RECOVERY:2e3},k={HIGH:.9,CRITICAL:.95},P={MAX_CPU:80,MAX_MEMORY:85,MAX_EVENT_LOOP:50,MAX_CALL_RATE:1e3},H={system:{cpu:0,memory:0,eventLoop:0,isOverloaded:!1},breathing:{breathCount:0,currentRate:D.BASE,lastBreath:Date.now(),stress:0,isRecuperating:!1,recuperationDepth:0,pattern:"NORMAL",nextBreathDue:Date.now()+D.BASE},performance:{callsTotal:0,callsPerSecond:0,lastCallTimestamp:Date.now(),activeQueues:{critical:0,high:0,medium:0,low:0,background:0},queueDepth:0},stress:{cpu:0,memory:0,eventLoop:0,callRate:0,combined:0},lastUpdate:Date.now(),inRecuperation:!1,hibernating:!1,activeFormations:0},X=()=>{const e=new Map;return{get:t=>e.get(t),set:(t,o)=>{e.set(t,o),e.size>1e3&&Array.from(e.keys()).slice(0,e.size-1e3).forEach((t=>e.delete(t)))},forget:t=>e.delete(t),clear:()=>e.clear(),getAll:()=>Array.from(e.values()),size:()=>e.size}},Y=X();Y.set("quantum",H);const F=d(((e,t)=>{const o=Math.min(1,(e.cpu||0)/(.7*P.MAX_CPU)),r=Math.min(1,(e.memory||0)/(.7*P.MAX_MEMORY)),i=Math.min(1,(e.eventLoop||0)/(.7*P.MAX_EVENT_LOOP)),n=Math.min(1,(t.callsPerSecond||0)/(.7*P.MAX_CALL_RATE)),a=Math.max(o,r,i,n);return{cpu:o,memory:r,eventLoop:i,callRate:n,combined:Math.min(1,(o+r+i+n+2*a)/6)}})),V=e=>{if(e>=k.CRITICAL)return D.RECOVERY;const t=Math.exp(e)-1;return Math.max(D.MIN,Math.min(D.MAX,D.BASE*(1+t)))},U={inRecuperation:!1,hibernating:!1,activeFormations:0,recuperationInterval:void 0,get:()=>{const e=Y.get("quantum");return Object.freeze({...e,inRecuperation:U.inRecuperation,hibernating:U.hibernating,activeFormations:U.activeFormations})},update:e=>{const t={...Y.get("quantum"),...e,lastUpdate:Date.now(),inRecuperation:e.inRecuperation??U.inRecuperation,hibernating:e.hibernating??U.hibernating,activeFormations:e.activeFormations??U.activeFormations};return(e.system||e.performance)&&(t.stress=F(t.system,t.performance)),Y.set("quantum",t),t},updateBreath:e=>{const t=Y.get("quantum"),o=F(e,t.performance),r=Date.now(),i={...t.breathing,breathCount:t.breathing.breathCount+1,lastBreath:r,stress:o.combined,currentRate:V(o.combined),nextBreathDue:r+V(o.combined),isRecuperating:o.combined>k.HIGH,recuperationDepth:Math.min(1,o.combined),pattern:o.combined>k.HIGH?"RECOVERY":"NORMAL"};return U.update({system:e,breathing:i,stress:o,inRecuperation:i.isRecuperating})},recordCall:(e="medium")=>{const t=Y.get("quantum"),o=Date.now(),r=o-t.performance.lastCallTimestamp>=1e3?1:t.performance.callsPerSecond+1,i={...t.performance,callsTotal:t.performance.callsTotal+1,callsPerSecond:r,lastCallTimestamp:o,activeQueues:{...t.performance.activeQueues,[e]:t.performance.activeQueues[e]+1},queueDepth:t.performance.queueDepth+1};return U.update({performance:i})},isHealthy:()=>{const e=Y.get("quantum");return!e.breathing.isRecuperating&&e.stress.combined<k.HIGH},shouldAllowCall:e=>{const t=Y.get("quantum");return t.breathing.isRecuperating?"critical"===e:t.stress.combined<k.HIGH||"critical"===e||"high"===e},reset:()=>{U.inRecuperation=!1,U.hibernating=!1,U.activeFormations=0,Y.set("quantum",H)},forget:e=>{Y.forget(e)}},B=X(),z=X(),q=X(),W=X(),j=X(),G=e=>{const t=j.get(e);t?.intervalId&&clearInterval(t.intervalId),j.forget(e),W.forget(e)},Z=e=>{if(!e?.id)throw new Error("IO must have an id");try{const t={...e,timestamp:Date.now(),type:e.type||e.id};G(e.id),B.set(e.id,t),j.set(e.id,{lastExecutionTime:Date.now(),executionCount:0,errors:[]}),e.detectChanges&&W.set(e.id,e.payload),U.recordCall(e.priority?.level)}catch(t){throw s.error(`Failed to set IO: ${t instanceof Error?t.message:String(t)}`),t}},K=e=>B.get(e),Q=e=>(G(e),B.forget(e)),J=()=>{B.getAll().forEach((e=>{e.id&&G(e.id)})),W.clear(),j.clear(),B.clear(),U.reset()},ee=(e,t)=>{const o=W.get(e);return!l(t,o)},te=e=>W.get(e),oe=e=>j.get(e),re=e=>{if(!e?.id||!e?.fn)throw new Error("Invalid subscriber format");z.set(e.id,e)},ie=e=>z.get(e),ne=()=>z.clear(),ae=e=>{e.id&&q.set(e.id,e)},se=e=>q.get(e),de=e=>{const t=q.get(e);return t?.timeoutId&&clearTimeout(t.timeoutId),q.forget(e)},ce=()=>{q.getAll().forEach((e=>{e.timeoutId&&clearTimeout(e.timeoutId)})),q.clear()},le=()=>q.getAll(),ue=()=>q.getAll().filter((e=>"active"===e.status)),he=e=>e.type&&e.id?{...e,ok:!0,status:"active"}:{...e,ok:!1,done:!1,status:"error",error:"Missing required fields: type or id"},me=e=>e.detectChanges?ee(e.id,e.payload)?e:{...e,ok:!0,done:!0,status:"skipped",skipped:!0,skipReason:y}:e,fe=e=>{if(e.skipped||"error"===e.status)return e;try{const t=ie(e.id);if(!t)throw new Error("No subscriber found");const o=t.fn(e.payload);return o&&"object"==typeof o&&"id"in o?{...e,ok:!0,done:!0,status:"completed",intraLink:{id:o.id,payload:o.payload}}:{...e,ok:!0,done:!0,status:"completed"}}catch(t){return s.error(`${p}: ${t}`),{...e,ok:!1,done:!1,status:"error",error:t instanceof Error?t.message:String(t)}}},ge=(e,t)=>{if(!e)return s.error(g),{id:"",type:"",ok:!1,done:!1,status:"error",error:g};try{return c((e=>{try{if(!e)throw new Error(g);return{...e,ok:!0,done:!1,status:"pending",timestamp:Date.now()}}catch(t){return{id:"",type:"",ok:!1,done:!1,status:"error",error:g}}})(e),he,me,fe,(e=>{return"error"===e.status?e:((t=e).log&&("error"===t.status?s.error(t):(t.status,s.info(t))),t);var t}),(e=>{return"error"===e.status?e:((t=e).ok&&!t.skipped&&Z({...t,timestamp:Date.now()}),t);var t}))}catch(o){return s.error(`Action processing failed: ${o}`),{...e,ok:!1,done:!1,status:"error",error:o instanceof Error?o.message:String(o)}}},pe=d((e=>e?e.id?e.type||e.id?e.type&&"string"!=typeof e.type?{isValid:!1,error:C}:{isValid:!0}:{isValid:!1,error:w}:{isValid:!1,error:I}:{isValid:!1,error:b})),ye=(e,t)=>{try{if(!("object"==typeof(i=e)&&null!==i&&"id"in i&&"string"==typeof i.id&&i.id.length>0))return s.error(b),{ok:!1,message:b};const n=pe(e);if(!n.isValid)return s.error(n.error),{ok:!1,message:n.error};if(o=e,(r=t)&&!Object.entries(r).filter((([e,t])=>t(void 0).required)).map((([e])=>e)).every((e=>e in o)))return s.error(S),{ok:!1,message:S};const a=((e,t)=>{try{const o={...e},r=[];for(const[i,n]of Object.entries(e)){const e=t[i];if(!e){o[i]=n;continue}const a=e(n);if(!a.ok){if(a.required)return{ok:!1,message:`Required field '${i}' validation failed: ${a.message}`,payload:o};r.push(`${i}: ${a.message}`)}o[i]=a.payload}for(const[i,n]of Object.entries(t))if(n(void 0).required&&!(i in e))return{ok:!1,message:`Missing required field: ${i}`,payload:o};return r.length>0?{ok:!1,message:r.join("; "),payload:o}:{ok:!0,payload:o}}catch(o){const e=o instanceof Error?o.message:String(o);return s.error(`Data definition processing failed: ${e}`),{ok:!1,message:S}}})(e,t);if(!a.ok)return a;const d=(e=>{const t=Date.now();return{...e,type:e.type||e.id,timestamp:t,interval:e.interval||0,timeOfCreation:e.timeOfCreation||t}})({...a.payload,id:e.id});return s.success(E),{ok:!0,message:E,payload:d}}catch(n){const e=n instanceof Error?n.message:String(n);return s.error(`Channel processing failed: ${e}`),{ok:!1,message:v}}var o,r,i},ve=(e,t)=>{try{const i=(r=t,(o=e)&&"string"==typeof o?"function"!=typeof r?{ok:!1,message:_,error:{code:"INVALID_HANDLER",message:"Event handler must be a function"}}:{ok:!0,message:T,subscriber:{id:o.trim(),fn:r}}:{ok:!1,message:C,error:{code:"INVALID_TYPE",message:`Type must be a non-empty string, received: ${o}`}});if(!i.ok||!i.subscriber)return s.error(i.error||i.message),{ok:!1,message:i.message};const{subscriber:n}=i;return ie(n.id)&&s.info(`${n.id}: ${O}`),re(n),s.info(`${T}: ${n.id}`),{ok:!0,message:`${T}: ${n.id}`}}catch(i){const e=i instanceof Error?i.message:String(i);return s.error(`Failed to add subscriber: ${e}`),{ok:!1,message:L}}var o,r},Ee=(e,t)=>Array.isArray(e)?(e=>{try{const t=e.map((e=>{if(!e.id||!e.fn)return s.error(`Invalid subscriber format: ${JSON.stringify(e)}`),!1;try{return re(e),!0}catch(t){return s.error(`Failed to add subscriber ${e.id}: ${t}`),!1}})).filter(Boolean).length,o=e.length;return 0===t?{ok:!1,message:`Failed to add any subscribers out of ${o}`}:{ok:!0,message:`Successfully added ${t} out of ${o} subscribers`}}catch(t){const e=t instanceof Error?t.message:String(t);return s.error(`Batch subscription failed: ${e}`),{ok:!1,message:L}}})(e):"string"==typeof e&&t?ve(e,t):(s.error(R),{ok:!1,message:R}),Se=async e=>{if(!e||!e.id)return;const t=performance.now(),o=se(e.id);if(o&&o.isActive)try{await e.callback();const r=performance.now()-t;o.metrics.totalExecutions++,o.metrics.successfulExecutions++,o.metrics.lastExecutionTime=r,o.metrics.longestExecutionTime=Math.max(o.metrics.longestExecutionTime,r),o.metrics.shortestExecutionTime=Math.min(o.metrics.shortestExecutionTime,r),o.metrics.averageExecutionTime=(o.metrics.averageExecutionTime*(o.metrics.totalExecutions-1)+r)/o.metrics.totalExecutions,o.executionCount++,o.lastExecutionTime=Date.now(),!0!==o.repeat&&"number"==typeof o.repeat&&(o.repeat=o.repeat-1),ae(o),!0===o.repeat||"number"==typeof o.repeat&&o.repeat>0?we(o):de(o.id)}catch(r){const t=se(e.id);t&&(t.metrics.failedExecutions++,ae(t)),s.error(`Timer execution failed: ${r}`)}},Ie=e=>{if(!e||!e.id)return;const t=e.duration>u.RECUPERATION?u.RECUPERATION:Math.max(e.duration/10,1e3);let o,r=Date.now();const i=()=>{const n=se(e.id);if(!n||!n.isActive)return void clearTimeout(o);const a=Date.now(),s=U.get(),d=1+(s.stress?.combined||0);if(a-r>t||Math.abs(d-1)>.1){const e=n.originalDuration-n.executionCount*u.MAX_TIMEOUT;n.duration=Math.min(e,u.MAX_TIMEOUT)*d,n.nextExecutionTime=a+n.duration,ae(n),r=a}s.hibernating||"active"!==n.status||(o=setTimeout(i,t),n.recuperationInterval=o,ae(n))};return o=setTimeout(i,t),o},we=e=>{if(!e||!e.id)return;const t=U.get();if(t.hibernating)return;const o=Date.now(),r=1+(t.stress?.combined||0),i=se(e.id);if(!i||!i.isActive)return;if(i.executionCount>1e4)return s.error("Maximum execution count exceeded"),void de(i.id);let n=i.duration*r;if(i.isInRecuperation){const e=i.originalDuration-i.executionCount*u.MAX_TIMEOUT;n=Math.min(e*r,u.MAX_TIMEOUT),i.duration=n,i.duration>u.RECUPERATION&&(i.recuperationInterval&&clearTimeout(i.recuperationInterval),i.recuperationInterval=Ie(i)),e<=u.MAX_TIMEOUT&&(i.isInRecuperation=!1)}else i.duration=n;i.nextExecutionTime=o+i.duration,i.timeoutId&&clearTimeout(i.timeoutId);const a="undefined"!=typeof process&&"test"===process.env.NODE_ENV;i.timeoutId=a?setTimeout((()=>Se(i)),i.duration):i.duration<25?((e,t)=>{if("undefined"!=typeof process&&"test"===process.env.NODE_ENV)return setTimeout(e,t);const o=process.hrtime(),r=()=>{const[i,n]=process.hrtime(o),a=1e3*i+n/1e6;if(a>=t)e();else{const e=t-a;e<1?setImmediate(r):e<25?setTimeout(r,0):setTimeout(r,Math.floor(e/2))}};return setTimeout(r,0)})((()=>Se(i)),i.duration):setTimeout((()=>Se(i)),i.duration),ae(i)},Ce=(e,t,o,r=crypto.randomUUID())=>{try{const n=((e,t,o,r)=>{if(!e||"number"!=typeof t||"function"!=typeof o)throw new Error("Invalid formation parameters");const i=Date.now(),n=t>=u.MAX_TIMEOUT,a=U.get(),s=1+(a.stress?.combined||0),d={id:e,startTime:i,duration:n?u.MAX_TIMEOUT:t*s,originalDuration:t,callback:o,repeat:r,executionCount:0,lastExecutionTime:0,nextExecutionTime:i+(n?u.MAX_TIMEOUT:t*s),isInRecuperation:n,status:"active",isActive:!0,metrics:{totalExecutions:0,successfulExecutions:0,failedExecutions:0,averageExecutionTime:0,lastExecutionTime:0,longestExecutionTime:0,shortestExecutionTime:1/0,missedExecutions:0}};return n&&(d.recuperationInterval=Ie(d)),d})(r,"number"==typeof e?e:24*((i=e).days||0)*60*60*1e3+60*(i.hours||0)*60*1e3+60*(i.minutes||0)*1e3+1e3*(i.seconds||0)+(i.milliseconds||0),t,o);return ae(n),we(n),{kind:"ok",value:n}}catch(n){return{kind:"error",error:n instanceof Error?n:new Error("Timer creation failed")}}var i},be=e=>{if(e){const t=se(e);t&&(t.timeoutId&&clearTimeout(t.timeoutId),t.recuperationInterval&&clearTimeout(t.recuperationInterval),t.status="paused",t.isActive=!1,ae(t))}else le().forEach((e=>{e.timeoutId&&clearTimeout(e.timeoutId),e.recuperationInterval&&clearTimeout(e.recuperationInterval),e.status="paused",e.isActive=!1,ae(e)}))},Re=e=>{if(!U.get().hibernating)if(e){const t=se(e);t&&"paused"===t.status&&(t.status="active",t.isActive=!0,ae(t),we(t))}else le().forEach((e=>{"paused"===e.status&&(e.status="active",e.isActive=!0,ae(e),we(e))}))},Oe=()=>{U.update({hibernating:!0}),le().forEach((e=>{e.timeoutId&&clearTimeout(e.timeoutId),e.recuperationInterval&&clearTimeout(e.recuperationInterval)})),ce()},Te={id:(e="")=>"string"==typeof e?{ok:!0,payload:e}:{ok:!1,payload:null,message:`action.id must be a string. Received '${e}'`,required:!0},type:(e="")=>"string"==typeof e?{ok:!0,payload:e}:{ok:!1,payload:null,message:`action.type must be a string. Received '${e}'`,required:!0},payload:(e=null)=>({ok:!0,payload:e}),interval:(e=0)=>Number.isInteger(e)?{ok:!0,payload:e}:{ok:!1,payload:0,message:`'${e}' invalid action.interval value`,required:!1},timeOfCreation:(e=0)=>Number.isInteger(e)?{ok:!0,payload:e}:{ok:!1,payload:0,message:`'${e}' invalid @cyre.call time of creation value`,required:!0},repeat:(e=0)=>Number.isInteger(e)?{ok:!0,payload:e}:{ok:!1,payload:0,message:`'${e}' invalid action.repeat value`,required:!1},message:(e="")=>"string"==typeof e?{ok:!0,payload:e}:{ok:!1,payload:"",message:`action.message must be a string. Received '${e}'`,required:!1},group:(e="")=>"string"==typeof e?{ok:!0,payload:e}:{ok:!1,payload:null,message:`'${e}' invalid action.group value`,required:!1},callback:(e="")=>"string"==typeof e?{ok:!0,payload:e}:{ok:!1,payload:null,message:`'${e}' invalid action.callback value`,required:!1},log:(e=!1)=>"boolean"==typeof e?{ok:!0,payload:e}:{ok:!1,payload:!1,message:`'${e}' invalid action.log value`,required:!1},middleware:(e="")=>"string"==typeof e?{ok:!0,payload:e}:{ok:!1,payload:null,message:`'${e}' invalid action.middleware value`,required:!1},throttle:(e=0)=>Number.isInteger(e)?{ok:!0,payload:e}:{ok:!1,payload:100,message:`'${e}'  action.throttle value must be a number`,required:!1},debounce:(e=0)=>Number.isInteger(e)?{ok:!0,payload:e}:{ok:!1,payload:100,message:`'${e}'  action.debounce value must be a number`,required:!1},at:(e=0)=>({ok:!1,payload:e,message:`'${e}'  action.at is an experimental feature, not applied yet`,required:!1})},_e=function(e=crypto.randomUUID()){let t=!1;const o=async(e,t,o)=>{const r=Ce(t,(async()=>{U.isHealthy()&&await i({...e,timeOfCreation:performance.now(),payload:o??e.payload})}),e.repeat||!0,e.id);return"error"===r.kind?{ok:!1,payload:null,message:r.error.message}:{ok:!0,payload:null,message:`Scheduled with breathing-adjusted interval: ${Math.round(t)}ms`}},r=async(e,t)=>{const o=e.priority?.level||"medium";if(!U.shouldAllowCall(o)){const{stress:e}=U.get();return{ok:!1,payload:null,message:`System under high stress (${(100*e.combined).toFixed(1)}%). Try later.`}}return n(e,t)},i=async e=>{if(!e?.type)throw new Error("Invalid IO object");try{const o=ie(e.type)||ie(e.id);if(!o){const t=`${M} ${e.type}`;return s.error(t),{ok:!1,payload:null,message:t}}const r=performance.now(),i=ge({...e},o.fn);if(e.log&&s.info({...i,executionTime:performance.now()-r,timestamp:Date.now()}),i?.intraLink)try{const{id:e,payload:t}=i.intraLink;await a(e,t)}catch(t){s.error(`Linked action error: ${t}`)}return{ok:!0,payload:i,message:f}}catch(t){const e=t instanceof Error?t.message:String(t);return s.error(`Dispatch error: ${e}`),{ok:!1,payload:null,message:`Dispatch error: ${e}`}}},n=async(e,t)=>{try{if(e.throttle){const t=Date.now()-(oe(e.id)?.lastExecutionTime||0);if(t<e.throttle)return{ok:!1,payload:null,message:`Throttled: ${e.throttle-t}ms remaining`}}const o=await i({...e,timeOfCreation:performance.now(),payload:t??e.payload});return U.recordCall(e.priority?.level),o}catch(o){return{ok:!1,payload:null,message:`Call failed: ${o instanceof Error?o.message:String(o)}`}}},a=async(e,i)=>{if(t)return{ok:!1,message:A,payload:null};if(!e?.trim())return{ok:!1,message:$,payload:null};const a=K(e.trim());return a?(async(e,t)=>{if(!e)return{ok:!1,payload:null,message:"Invalid action"};const{breathing:i,stress:a}=U.get();if(i.isRecuperating&&"critical"!==e.priority?.level)return{ok:!1,payload:null,message:`System recuperating (${(100*i.recuperationDepth).toFixed(1)}% depth). Try later.`};if(e.interval){const r=e.interval*(1+a.combined);return o(e,r,t)}return a.combined>=k.HIGH?r(e,t):n(e,t)})(a,i):{ok:!1,payload:null,message:`${N}: ${e}`}},d=()=>{if(!t)try{le().forEach((e=>{e.timeoutId&&clearTimeout(e.timeoutId)})),Oe(),ne(),J(),U.reset(),t=!0,"undefined"!=typeof process&&process.exit&&process.exit(0)}catch(e){s.error(`Failed to shutdown gracefully: ${e}`),"undefined"!=typeof process&&process.exit&&process.exit(1)}};return"undefined"!=typeof window?window.addEventListener("beforeunload",d):(process.on("SIGINT",d),process.on("SIGTERM",d),process.on("uncaughtException",(e=>{console.error("Uncaught Exception:",e),d()}))),{initialize:()=>(t=!1,Ce(D.BASE,(async()=>{const e=U.get();U.updateBreath({cpu:e.system.cpu,memory:e.system.memory,eventLoop:e.system.eventLoop,isOverloaded:e.system.isOverloaded})}),!0),Re(),console.log("%c"+x,"background: rgb(151, 2, 151); color: white; display: block;"),{ok:!0,payload:200,message:f}),call:a,action:e=>{if(t)s.error(h);else try{if(Array.isArray(e))e.forEach((e=>{const t=ye({...e,type:e.type||e.id},Te);t.ok&&t.payload&&Z(t.payload)}));else{const t=ye({...e,type:e.type||e.id},Te);t.ok&&t.payload&&Z(t.payload)}}catch(o){s.error(`Action registration failed: ${o}`)}},on:Ee,shutdown:d,status:()=>(t?s.info({ok:!0,message:h}):s.info({ok:!0,message:m}),t),forget:e=>t?(s.error(A),!1):(be(e),Q(e)),get:e=>{if(!t)return K(e);s.error(A)},pause:e=>{if(t)return void s.error(A);be(e);const o=le();if(e){const t=se(e);t&&ae({...t,status:"paused"})}else o.forEach((e=>{e&&ae({...e,status:"paused"})}))},resume:e=>{if(t)return void s.error(A);Re(e);const o=le();if(e){const t=se(e);t&&ae({...t,status:"active"})}else o.forEach((e=>{e&&ae({...e,status:"active"})}))},hasChanged:(e,o)=>t?(s.error(A),!1):ee(e,o),getPreviousPayload:e=>{if(!t)return te(e);s.error(A)},getBreathingState:()=>U.get().breathing,getPerformanceState:()=>{const e=U.get();return{totalProcessingTime:0,totalCallTime:0,totalStress:e.stress.combined,stress:e.stress.combined}},getMetrics:e=>t?{hibernating:!0,activeFormations:0,inRecuperation:!1,breathing:U.get().breathing,formations:[]}:{hibernating:!1,activeFormations:ue().length,inRecuperation:!1,breathing:U.get().breathing,formations:le().filter((t=>t.id===e)).map((e=>({...e,breathingSync:1})))}}},Le=_e("quantum-inceptions");Le.initialize(),e.Cyre=_e,e.CyreLog=s,e.cyre=Le,e.debounce=(e,t)=>{let o,r;const i=(...i)=>{r=i,clearTimeout(o),o=setTimeout((()=>e(...r)),t)};return i.cancel=()=>{clearTimeout(o)},i},e.default="./app",e.isEqual=l,e.memoize=d,e.pipe=c,e.throttle=(e,t)=>{let o,r=null,i=0;const n=(...n)=>{o=n;const a=Date.now();i&&a<i+t?null===r&&(r=setTimeout((()=>{i=Date.now(),r=null,e(...o)}),t)):(i=a,e(...n))};return n.cancel=()=>{r&&(clearTimeout(r),r=null)},n},e.tryCatch=async e=>{try{return{kind:"ok",value:await e()}}catch(t){return{kind:"error",error:t instanceof Error?t:new Error(String(t))}}},e.version="3.1.2",Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}(t.exports)),t.exports}var r=o();const i="touch_start",n="touch_end",a="drag_horizontal",s="drag_vertical",d="track_velocity",c="process_touch_end",l={INIT_CAROUSEL:"init_carousel",INIT_DIMENSIONS:"init_dimensions",STATE_UPDATE:"state_update",STATE_BATCH_UPDATE:"state_batch_update",REFRESH_CAROUSEL:"refresh_carousel",REFRESH_SCREEN:"refresh_screen",SNAP_TO_POSITION:"snap_to_position",SNAP:"snap",TRANSFORM_COMPLETE:"transform_complete",ANIMATE_FORWARD:"animate_forward",ANIMATE_BACKWARD:"animate_backward",NEXT_SLIDE:"next_slide",PREV_SLIDE:"prev_slide",FIRST_SLIDE:"first_slide",LAST_SLIDE:"last_slide",GO_TO_SLIDE:"go_to_slide",ACTIVATE:"activate",BRING_TO_FOCUS:"bring_to_focus",WHEEL_EVENT:"wheel_event",KEYBOARD_EVENT:"keyboard_event",SHAKE:"shake",ERROR_HANDLER:"error_handler",PERFORMANCE_MONITOR:"performance_monitor",PERFORMANCE_OPTIMIZE:"performance_optimize"},u=600,h="cubic-bezier(0.215, 0.61, 0.355, 1)",m=.8,f=.5,g=10,p={enabled:1,wheel:0,controller:0,drag:1,swipe:1,snap:3,focus:1,animate:0,animateDirection:1,duration:600,loop:0,orientation:0,active:!0,onClick:!0,onDoubleClick:!1},y="holo-carousel",v={id:null,virtual:null,startX:0,startY:0,currentX:0,currentY:0,lastX:0,lastY:0,distanceX:0,distanceY:0,directionX:0,directionY:0,velocityX:0,velocityY:0,startTransformX:0,startTransformY:0,pressed:!1,startTime:0,multiplier:1.5,orientation:!1,targetElement:null,moved:!1,isNested:!1},E={enabled:!0,paramPrefix:"slide",updateHistory:!0,scrollToCarousel:!0,nestedSeparator:"."},S=(e,t)=>{if(!t?.container||!t?.carousel)return r.CyreLog.error("Missing carousel DOM elements"),null;try{if(0===t.container.offsetWidth&&0===t.container.offsetHeight)return r.CyreLog.warn(`DOM not ready for measurement, carousel: ${e.id}`),null;const o=t.carousel.style.cssText,i=t.container.style.cssText;t.carousel.style.visibility="visible",t.carousel.style.display="block",t.container.style.visibility="visible",t.container.style.display="flex",t.carousel.offsetHeight,t.container.offsetHeight;const n=Array.from(t.container.children);if(0===n.length)return r.CyreLog.warn(`No slides found in carousel ${e.id}`),t.carousel.style.cssText=o,t.container.style.cssText=i,null;const a=Math.max(t.carousel.parentElement?.clientWidth||0,t.carousel.clientWidth||0,window.innerWidth||1024),s=Math.max(t.carousel.parentElement?.clientHeight||0,t.carousel.clientHeight||0,window.innerHeight||768),d=(e=>{if(!e)return 0;try{const t=window.getComputedStyle(e);if(t.gap&&"normal"!==t.gap){const e=parseInt(t.gap,10);if(!isNaN(e))return e}const o=window.getComputedStyle(document.documentElement).getPropertyValue("--holo-slide-gap");if(o){const e=parseInt(o,10);if(!isNaN(e))return e}const r=t.rowGap&&"normal"!==t.rowGap?parseInt(t.rowGap,10):0,i=t.columnGap&&"normal"!==t.columnGap?parseInt(t.columnGap,10):0;return Math.max(r||0,i||0)}catch(t){return r.CyreLog.warn("Error detecting flex gap:",t),0}})(t.container);let c=0,l=0,u=0,h=0;n.forEach(((e,t)=>{const o=e.style.cssText;e.style.visibility="visible",e.style.display="inline-block",e.offsetHeight;const r=window.getComputedStyle(e),i=parseInt(r.marginLeft)||0,a=parseInt(r.marginRight)||0,s=parseInt(r.marginTop)||0,m=parseInt(r.marginBottom)||0,f=e.offsetWidth+i+a,g=e.offsetHeight+s+m;u=Math.max(u,f),h=Math.max(h,g),c+=f,t<n.length-1&&(c+=d),l+=g,t<n.length-1&&(l+=d),e.style.cssText=o})),c+=.1*u,0===u&&(u=200),0===h&&(h=200),0===c&&(c=(u+d)*n.length-d),0===l&&(l=(h+d)*n.length-d);const m=Math.min(Math.max(1,Math.floor(a/(u+d))),e.item.max||10),f=e.io.orientation?a:Math.min(m*(u+d)-d,a),g=e.io.orientation?Math.min(m*(h+d)-d,s):h,p=e.io.orientation?a:c,y=e.io.orientation?l:h,v=e.io.orientation?-Math.max(0,y-g):-Math.max(0,p-f),E={width:u+d,height:h+d,actualWidth:u,actualHeight:h,gap:d};return t.carousel.style.cssText=o,t.container.style.cssText=i,r.CyreLog.info(`Carousel ${e.id} dimensions calculated:`,{slides:n.length,slideWidth:u,slideHeight:h,flexGap:d,slideWithGapWidth:E.width,slideWithGapHeight:E.height,carouselWidth:f,carouselHeight:g,containerWidth:p,containerHeight:y,endOfSlidePosition:v,totalWidth:c}),{...e,item:{...e.item,...E},numberOfSlots:m,carousel:{width:f,height:g},container:{width:p,height:y},endOfSlidePosition:v,noOfChildren:n.length}}catch(o){return r.CyreLog.error(`Error in dimension calculation for ${e.id}:`,o),null}},I=e=>new Promise((t=>{if(!M[e])return r.CyreLog.error(`Carousel ${e} not found`),void t(!1);const o=M[e].getState,{virtual:i,shadow:n}=o;r.CyreLog.info(`Force calculating dimensions for carousel ${e}`);const a=S(i,n);if(a&&(M[e].setDimension={...a},0===i.io.orientation&&a.item.width>0||1===i.io.orientation&&a.item.height>0))return r.CyreLog.info(`Successfully calculated dimensions for ${e}:`,{width:a.item.width,height:a.item.height,gap:a.item.gap}),void t(!0);r.CyreLog.warn(`Initial dimension calculation failed for ${e}, retrying with delay`),setTimeout((()=>{try{n.carousel&&(n.carousel.style.display="block"),n.container&&(n.container.style.display="flex"),n.carousel&&n.carousel.offsetHeight,n.container&&n.container.offsetHeight;const o=S(i,n);o?(M[e].setDimension={...o},r.CyreLog.info(`Retry succeeded for ${e}:`,{width:o.item.width,height:o.item.height,gap:o.item.gap}),t(!0)):(r.CyreLog.error(`Dimension calculation failed for ${e} after retry`),t(!1))}catch(o){r.CyreLog.error(`Error during retry for ${e}:`,o),t(!1)}}),300)})),w=e=>{if(!e?.id)return 0;const t=e.io.orientation?e.item.height||1:e.item.width||1,o=e.io.orientation?Math.abs(e.transformY):Math.abs(e.transformX);return Math.round(o/t)},C=(e,t=!1)=>e.io.orientation?t?(e=>{e.item.height&&!isNaN(e.item.height)||(r.CyreLog.warn(`Missing height for vertical carousel ${e.id}. Using fallback.`),e.item.height=200);const t={...e,transformX:0},o=e.container.height||0,i=e.carousel.height||0,n=-Math.max(0,o-i);return t.endOfSlidePosition=n,t.transformY>=0?(t.transformY=0,t.endOfSlide=1):t.transformY<=t.endOfSlidePosition?(t.transformY=t.endOfSlidePosition,t.endOfSlide=-1):t.endOfSlide=0,t})(e):(e=>{e.item.height&&!isNaN(e.item.height)||(r.CyreLog.warn(`Missing height for vertical carousel ${e.id}. Using fallback.`),e.item.height=200);const t={...e,transformX:0,transformY:e.io.snap&&e.item.height?x(e.transformY,e.item.height||0):e.transformY},o=e.container.height||0,i=e.carousel.height||0,n=-Math.max(0,o-i);return t.endOfSlidePosition=n,t.transformY>=0?(t.transformY=0,t.endOfSlide=1):t.transformY<=t.endOfSlidePosition?(t.transformY=t.endOfSlidePosition,t.endOfSlide=-1):t.endOfSlide=0,t})(e):t?(e=>{const t={...e,transformY:0},o=e.container.width||0,r=e.carousel.width||0,i=-Math.max(0,o-r);return t.endOfSlidePosition=i,t.transformX>=0?(t.transformX=0,t.endOfSlide=1):t.transformX<=t.endOfSlidePosition?(t.transformX=t.endOfSlidePosition,t.endOfSlide=-1):t.endOfSlide=0,t})(e):(e=>{e.item.width&&!isNaN(e.item.width)||(r.CyreLog.warn(`Missing width for horizontal carousel ${e.id}. Using fallback.`),e.item.width=200);const t={...e,transformY:0,transformX:e.io.snap&&e.item.width?x(e.transformX,e.item.width||0):e.transformX},o=e.container.width||0,i=e.carousel.width||0,n=-Math.max(0,o-i);return t.endOfSlidePosition=n,t.transformX>=0?(t.transformX=0,t.endOfSlide=1):t.transformX<=t.endOfSlidePosition?(t.transformX=t.endOfSlidePosition,t.endOfSlide=-1):t.endOfSlide=0,t})(e),b=e=>{if(!e?.id)return void r.CyreLog.error("Cannot navigate: Invalid virtual state");if(-1===e.endOfSlide&&!e.io.loop)return;if(-1===e.endOfSlide&&e.io.loop)return void r.cyre.call(l.FIRST_SLIDE,e);const t=e.io.orientation?e.item.height||0:e.item.width||0;if(!t)return void r.CyreLog.error(`Cannot navigate: Missing dimension for carousel ${e.id}`);const o=e.io.orientation?e.transformY:e.transformX,i=Math.round(Math.abs(o)/t),n=(e.noOfChildren||0)-1;let a=i+1;a>n&&!e.io.loop&&(a=n);const s=-Math.abs(a*t),d=e.endOfSlidePosition||0,c=Math.max(s,d),u={...e,transformX:e.io.orientation?e.transformX:c,transformY:e.io.orientation?c:e.transformY};r.CyreLog.info(`Navigating to next slide: ${i} -> ${a}, position: ${o} -> ${c}`),r.cyre.call(l.SNAP_TO_POSITION,u)},R=e=>{if(!e?.id)return void r.CyreLog.error("Cannot navigate: Invalid virtual state");if(1===e.endOfSlide&&!e.io.loop)return;if(1===e.endOfSlide&&e.io.loop)return void r.cyre.call(l.LAST_SLIDE,e);const t=e.io.orientation?e.item.height||0:e.item.width||0;if(!t)return void r.CyreLog.error(`Cannot navigate: Missing dimension for carousel ${e.id}`);const o=e.io.orientation?e.transformY:e.transformX,i=Math.round(Math.abs(o)/t);let n=i-1;n<0&&!e.io.loop&&(n=0);const a=-Math.abs(n*t),s={...e,transformX:e.io.orientation?e.transformX:a,transformY:e.io.orientation?a:e.transformY};r.CyreLog.info(`Navigating to previous slide: ${i} -> ${n}`),r.cyre.call(l.SNAP_TO_POSITION,s)},O=e=>{if(!e?.id)return void r.CyreLog.error("Cannot navigate: Invalid virtual state");const t={...e,transformX:0,transformY:0,endOfSlide:1};r.cyre.call(l.SNAP_TO_POSITION,t)},T=e=>{if(!e?.id)return void r.CyreLog.error("Cannot navigate: Invalid virtual state");const t=e.io.orientation?e.item.height||0:e.item.width||0,o=(e.noOfChildren||0)-1,i=-Math.abs(o*t),n=e.endOfSlidePosition||0,a=Math.max(i,n),s={...e,transformX:e.io.orientation?0:a,transformY:e.io.orientation?a:0,endOfSlide:-1};r.cyre.call(l.SNAP_TO_POSITION,s)},_=(e,t)=>{if(!e?.id)return void r.CyreLog.error("Cannot navigate: Invalid virtual state");const o=e.io.orientation?e.item.height||0:e.item.width||0;if(!o)return void r.CyreLog.error(`Cannot navigate: Missing dimension for carousel ${e.id}`);const i=(e.noOfChildren||0)-1,n=Math.min(Math.max(0,t),i),a=-Math.abs(n*o),s={...e,transformX:e.io.orientation?0:a,transformY:e.io.orientation?a:0};r.CyreLog.info(`Navigating to specific slide: ${n}`),r.cyre.call(l.SNAP_TO_POSITION,s)},L=(e,t)=>{if(!e||!t?.id)return void r.CyreLog.error("Cannot activate slide: Invalid parameters");const{offsets:o,selectedIndex:i}=((e,t)=>{if(!e?.id)return{offsets:[],selectedIndex:-1};const o=document.querySelector(`#${e.id} .holo-container`);if(!o)return{offsets:[],selectedIndex:-1};const r=Array.from(o.children),i=e.item.gap||0,n=r.map(((t,o)=>e.io.orientation?o*(e.item.actualHeight+i)||0:o*(e.item.actualWidth+i)||0));let a=-1;return t&&(a=r.findIndex((e=>e===t))),{offsets:n,selectedIndex:a}})(t,e);if(-1===i)return void r.CyreLog.error("Could not determine slide index");document.querySelectorAll(`#${t.id} .holo`).forEach((e=>{e.classList.remove("active")})),e.classList.add("active");const n={...t,transformX:t.io.orientation?t.transformX:-Math.abs(o[i]),transformY:t.io.orientation?-Math.abs(o[i]):t.transformY};r.cyre.call(l.SNAP_TO_POSITION,n)},A=(e,t=!0)=>{e?.id?t?-1===e.endOfSlide&&e.io.loop?O(e):b(e):1===e.endOfSlide&&e.io.loop?T(e):R(e):r.CyreLog.error("Cannot animate: Invalid virtual state")},$=e=>({animate:`animate_${e}`,snap:`snap_${e}`,prevSlide:`prev_slide_${e}`,nextSlide:`next_slide_${e}`,lastSlide:`last_slide_${e}`,firstSlide:`first_slide_${e}`,goToSlide:`go_to_slide_${e}`,activate:`activate_${e}`,refresh:`refresh_${e}`,transform:`transform_${e}`,stateUpdate:`state_update_${e}`,dimensionUpdate:`dimension_update_${e}`,error:`error_${e}`});const N=(e,t={})=>{if(!e||"string"!=typeof e)return void r.CyreLog.error(`Cannot initialize events for invalid carousel: ${e}`);if(!M[e])return void r.CyreLog.error(`Carousel ${e} not found for event initialization`);const o=M[e].getVirtual,i=$(e);M[e].setState={...o,eventIds:i},Object.values(i).forEach((e=>{e&&r.cyre.forget(e)})),r.cyre.on(i.animate,(t=>(r.CyreLog.info(`Animation event triggered for ${e}`),{id:o.io.animateDirection>0?l.ANIMATE_FORWARD:l.ANIMATE_BACKWARD,payload:t}))),r.cyre.on(i.snap,(e=>({id:l.SNAP,payload:e}))),r.cyre.on(i.prevSlide,(e=>({id:l.PREV_SLIDE,payload:e}))),r.cyre.on(i.nextSlide,(e=>({id:l.NEXT_SLIDE,payload:e}))),r.cyre.on(i.firstSlide,(e=>({id:l.FIRST_SLIDE,payload:e}))),r.cyre.on(i.lastSlide,(e=>({id:l.LAST_SLIDE,payload:e}))),r.cyre.on(i.goToSlide,(t=>({id:l.GO_TO_SLIDE,payload:{virtual:M[e].getVirtual,index:t.index}}))),r.cyre.on(i.activate,(e=>({id:l.ACTIVATE,payload:e}))),r.cyre.on(i.refresh,(t=>({id:l.REFRESH_CAROUSEL,payload:t||M[e].getState}))),r.cyre.on(i.error,(t=>({id:l.ERROR_HANDLER,payload:{...t,id:e}}))),r.cyre.action([{id:i.animate,interval:t.duration||u,repeat:!!t.animate||0,log:!0},{id:i.snap,throttle:50},{id:i.prevSlide,throttle:300},{id:i.nextSlide,throttle:300},{id:i.firstSlide},{id:i.lastSlide},{id:i.goToSlide,throttle:300},{id:i.activate,throttle:300},{id:i.refresh,throttle:100},{id:i.error}]),t.animate&&0!==t.animate&&(r.CyreLog.info(`Starting animation for carousel ${e}`),r.cyre.call(i.animate,M[e].getVirtual)),0!==t.performance&&(r.cyre.action({id:`performance_monitor_${e}`,interval:5e3,repeat:!0}),r.cyre.on(`performance_monitor_${e}`,(()=>({id:l.PERFORMANCE_MONITOR,payload:{id:e}}))),r.cyre.call(`performance_monitor_${e}`))},M={},x=(e,t)=>Math.round(e/t)*t,D={},k=(e,t)=>{if(D[e]?.parentId===t)return;const o=D[t]?.level||0,i=o+1;D[e]={id:e,parentId:t,childIds:D[e]?.childIds||[],level:i},D[t]?D[t].childIds.includes(e)||D[t].childIds.push(e):D[t]={id:t,childIds:[e],level:o},r.CyreLog.info(`Registered carousel ${e} as child of ${t} (level ${i})`)},P=e=>{const t=[];let o=e;for(;D[o]?.parentId;){const e=D[o].parentId;if(!e)break;t.push(e),o=e}return t},H=e=>{const t=[],o=[...D[e]?.childIds||[]];for(;o.length>0;){const e=o.pop();if(e){t.push(e);const r=D[e]?.childIds||[];o.push(...r)}}return t},X=e=>D[e]?.childIds||[],Y=e=>D[e]?.parentId;const F=(e,t,o={})=>{e.preventDefault(),o.stopPropagation&&e.stopPropagation(),r.cyre.call(i,{event:e,id:t,options:o})},V=(e,t)=>{e.stopPropagation(),F(e,t,{stopPropagation:!0})},U=(e,t)=>e/(t||1),B=e=>e<300,z=()=>{if(document.getElementById("holo-touch-styles"))return;const e=document.createElement("style");e.id="holo-touch-styles",e.textContent='\n    /* Base touch styles */\n    .holo-touch-active {\n      cursor: grabbing !important;\n    }\n    \n    /* Nested carousel touch styles */\n    .holo-carousel[data-nested="true"] {\n      touch-action: none;\n      z-index: 2;\n    }\n    \n    /* Parent carousel with active child */\n    .holo-carousel[data-child-active="true"] {\n      pointer-events: none;\n    }\n    \n    .holo-carousel[data-child-active="true"] .holo-container {\n      transition: none !important;\n    }\n    \n    /* But allow child events */\n    .holo-carousel[data-child-active="true"] [data-nested="true"] {\n      pointer-events: auto;\n    }\n  ',document.head.appendChild(e)};z();const q={},W=(e,t={})=>{q[e]={...E,...t},j(),window._holoDeepLinkingInitialized||(window.addEventListener("hashchange",j),window._holoDeepLinkingInitialized=!0),r.cyre.on(`${e}_slide_changed`,(t=>{Z(e,t)})),r.cyre.action({id:`${e}_slide_changed`,throttle:200}),r.cyre.on(l.TRANSFORM_COMPLETE,(t=>{t.id===e&&r.cyre.call(`${e}_slide_changed`,t.position)}))},j=()=>{const e=window.location.hash.substring(1);if(!e)return;const t=new URLSearchParams(e);Object.keys(q).forEach((e=>{const o=q[e];if(!o.enabled)return;const r=M[e]?.getVirtual;if(!r)return;const i=`${o.paramPrefix}-${e}`;if(t.has(i)){const n=t.get(i).split(o.nestedSeparator),a=parseInt(n[0],10);isNaN(a)||(_(r,a),o.scrollToCarousel&&setTimeout((()=>{const t=document.getElementById(e);t&&t.scrollIntoView({behavior:"smooth",block:"nearest"})}),100),n.length>1&&D[e]&&G(e,n.slice(1)))}}))},G=(e,t)=>{if(!D[e]||0===t.length)return;const o=X(e);if(0===o.length)return;const r=parseInt(t[0].split(":")[0],10);if(isNaN(r)||r>=o.length)return;const i=o[r],n=parseInt(t[0].split(":")[1],10),a=M[i]?.getVirtual;a&&!isNaN(n)&&setTimeout((()=>{_(a,n),t.length>1&&G(i,t.slice(1))}),100)},Z=(e,t)=>{const o=q[e];if(!o?.enabled||!o.updateHistory)return;const r=window.location.hash.substring(1),i=new URLSearchParams(r),n=`${o.paramPrefix}-${e}`,a=K(e,t);i.set(n,a);const s=`#${i.toString()}`;window.location.hash!==s&&(o.updateHistory?window.history.pushState(null,"",s):window.location.hash=s)},K=(e,t)=>{const o=q[e];let r=`${t}`;if(D[e]?.childIds?.length>0){const i=X(e);i.filter((o=>{const r=document.getElementById(o);if(!r)return!1;const i=Array.from(document.querySelectorAll(`#${e} .holo`))[t];return i&&i.contains(r)})).forEach((e=>{const t=i.indexOf(e),n=M[e]?.getVirtual;if(n){const i=Q(n),a=K(e,i);r+=`${o.nestedSeparator}${t}:${a}`}}))}return r},Q=e=>{const t=e.io.orientation?e.item.height||1:e.item.width||1,o=e.io.orientation?Math.abs(e.transformY):Math.abs(e.transformX);return Math.round(o/t)},J=(e,t={})=>{W(e,{...E,...t,enabled:!0})},ee={mode:0,expand:0,defaultOpen:0,animation:1,headerHeight:48,headerWidth:48},te=(e,t)=>{if(!e.io.accordionMode)return;r.CyreLog.info(`Initializing accordion mode for ${e.id}`);const o=Array.from(t.container.children);if(0===o.length)return void r.CyreLog.warn(`No panels found in accordion ${e.id}`);const i=o.map((e=>{const t=e.style.cssText;e.style.height="auto",e.style.width="auto",e.style.display="block",e.style.overflow="visible",e.offsetHeight;const o={width:e.offsetWidth,height:e.offsetHeight};return e.style.cssText=t,o})),n=!!e.io.orientation,a=n?e.accordionOptions?.headerHeight||48:i[0].height,s=n?i[0].width:e.accordionOptions?.headerWidth||48,d=Math.max(...i.map((e=>e.height))),c=Math.max(...i.map((e=>e.width))),l=e.accordionOptions?.defaultOpen>=0&&e.accordionOptions.defaultOpen<o.length?[e.accordionOptions.defaultOpen]:[];M[e.id].setState={...e,accordionState:{openPanels:l,previouslyOpen:[],expandedHeight:d,expandedWidth:c,collapsedHeight:a,collapsedWidth:s}},ie(e.id),oe(e.id,o)},oe=(e,t)=>{t.forEach(((t,o)=>{let r=t.querySelector(".accordion-header");if(!r){r=document.createElement("div"),r.className="accordion-header";const e=t.querySelector("h1, h2, h3, h4, h5, h6");e?(r.innerHTML=e.outerHTML,e.remove()):r.textContent=`Panel ${o+1}`,t.firstChild?t.insertBefore(r,t.firstChild):t.appendChild(r)}let i=t.querySelector(".accordion-content");i||(i=document.createElement("div"),i.className="accordion-content",Array.from(t.children).forEach((e=>{e===r||e.classList.contains("accordion-content")||i.appendChild(e)})),t.appendChild(i)),r.addEventListener("click",(t=>{t.preventDefault(),t.stopPropagation(),re(e,o)}))}))},re=(e,t)=>{const o=M[e]?.getVirtual;if(!o||!o.accordionState)return void r.CyreLog.error(`Invalid accordion state for ${e}`);const i=[...o.accordionState.openPanels];let n;n=o.accordionState.openPanels.includes(t)?o.accordionState.openPanels.filter((e=>e!==t)):o.accordionOptions?.expand?[...o.accordionState.openPanels,t]:[t],M[e].setState={...o,accordionState:{...o.accordionState,openPanels:n,previouslyOpen:i}},ie(e)},ie=e=>{const t=M[e]?.getVirtual,o=M[e]?.getShadow;if(!t||!o||!t.accordionState)return void r.CyreLog.error(`Cannot apply accordion state for ${e}`);const i=Array.from(o.container.children),n=t.accordionState.openPanels,a=!!t.io.orientation;i.forEach(((e,o)=>{const r=n.includes(o),i=e.querySelector(".accordion-header"),s=e.querySelector(".accordion-content");e.classList.toggle("accordion-open",r),e.classList.toggle("accordion-closed",!r),i&&(i.classList.toggle("accordion-header-open",r),i.classList.toggle("accordion-header-closed",!r)),s&&(s.classList.toggle("accordion-content-open",r),s.classList.toggle("accordion-content-closed",!r),a?(s.style.height=r?`${t.accordionState.expandedHeight}px`:"0",s.style.overflow=r?"visible":"hidden"):(s.style.width=r?`${t.accordionState.expandedWidth}px`:"0",s.style.overflow=r?"visible":"hidden"),t.accordionOptions?.animation?s.style.transition=a?`height ${t.duration}ms ${t.transitionTiming}`:`width ${t.duration}ms ${t.transitionTiming}`:s.style.transition="none")})),ne(e)},ne=e=>{const t=M[e]?.getVirtual,o=M[e]?.getShadow;if(!t||!o||!t.accordionState)return;const r=!!t.io.orientation,i=Array.from(o.container.children),n=t.accordionState.openPanels;if(r){let e=0;i.forEach(((o,r)=>{e+=t.accordionState?.collapsedHeight||0,n.includes(r)&&(e+=t.accordionState?.expandedHeight||0)})),o.container.style.height=`${e}px`}else{let e=0;i.forEach(((o,r)=>{e+=t.accordionState?.collapsedWidth||0,n.includes(r)&&(e+=t.accordionState?.expandedWidth||0)})),o.container.style.width=`${e}px`}},ae=()=>{if(document.getElementById("holo-accordion-styles"))return;const e=document.createElement("style");e.id="holo-accordion-styles",e.textContent='\n    /* Base accordion styles */\n    .holo-carousel[data-mode="accordion"] {\n      overflow: visible;\n    }\n    \n    .holo-carousel[data-mode="accordion"] .holo-container {\n      display: flex;\n      flex-direction: column;\n      transform: none !important; /* Override carousel transform */\n    }\n    \n    .holo-carousel[data-mode="accordion"][data-orientation="horizontal"] .holo-container {\n      flex-direction: row;\n    }\n    \n    /* Panel styles */\n    .holo-carousel[data-mode="accordion"] .holo {\n      transition: all 0.3s ease;\n      overflow: hidden;\n      flex-shrink: 0;\n      position: relative;\n    }\n    \n    /* Header styles */\n    .holo-carousel[data-mode="accordion"] .accordion-header {\n      cursor: pointer;\n      padding: 12px 15px;\n      background: rgba(0, 0, 0, 0.03);\n      border-bottom: 1px solid rgba(0, 0, 0, 0.1);\n      user-select: none;\n      display: flex;\n      align-items: center;\n      position: relative;\n    }\n    \n    .holo-carousel[data-mode="accordion"] .accordion-header::after {\n      content: "â–¼";\n      font-size: 0.8em;\n      margin-left: auto;\n      transition: transform 0.3s ease;\n    }\n    \n    .holo-carousel[data-mode="accordion"] .accordion-header-closed::after {\n      transform: rotate(-90deg);\n    }\n    \n    /* Content styles */\n    .holo-carousel[data-mode="accordion"] .accordion-content {\n      transition: height 0.3s ease, width 0.3s ease;\n      overflow: hidden;\n    }\n    \n    /* Vertical specific */\n    .holo-carousel[data-mode="accordion"][data-orientation="vertical"] .accordion-content {\n      width: 100%;\n    }\n    \n    /* Horizontal specific */\n    .holo-carousel[data-mode="accordion"][data-orientation="horizontal"] .holo {\n      height: 100%;\n      display: flex;\n      flex-direction: row;\n    }\n    \n    .holo-carousel[data-mode="accordion"][data-orientation="horizontal"] .accordion-header {\n      writing-mode: vertical-rl;\n      transform: rotate(180deg);\n      height: 100%;\n      width: auto;\n      border-right: 1px solid rgba(0, 0, 0, 0.1);\n      border-bottom: none;\n    }\n    \n    .holo-carousel[data-mode="accordion"][data-orientation="horizontal"] .accordion-header::after {\n      transform: rotate(90deg);\n      margin-top: 10px;\n      margin-left: 0;\n    }\n    \n    .holo-carousel[data-mode="accordion"][data-orientation="horizontal"] .accordion-header-closed::after {\n      transform: rotate(0deg);\n    }\n    \n    .holo-carousel[data-mode="accordion"][data-orientation="horizontal"] .accordion-content {\n      height: 100%;\n    }\n  ',document.head.appendChild(e)},se=(e,t={})=>{const o=M[e]?.getVirtual,i=M[e]?.getShadow;if(!o||!i)return void r.CyreLog.error(`Cannot convert carousel ${e} to accordion: not found`);ae();const n={...ee,...t,mode:1};M[e].setState={...o,io:{...o.io,accordionMode:1},accordionOptions:n},i.carousel.setAttribute("data-mode","accordion"),i.carousel.setAttribute("data-orientation",void 0!==t.mode?t.mode?"vertical":"horizontal":o.io.orientation?"vertical":"horizontal"),te(M[e].getVirtual,i)},de=(e,t)=>{if(!(e.id&&t&&t.carousel&&t.container))return void r.CyreLog.error(`Cannot setup DOM handlers for carousel ${e?.id}: Invalid shadow elements`);r.CyreLog.info(`Setting up DOM handlers for carousel ${e.id}`);const o=e.eventIds||{},i=e.nestedLevel>0||!!e.parentId;if(i&&(t.carousel.setAttribute("data-nested","true"),e.parentId&&t.carousel.setAttribute("data-parent",e.parentId)),e.io.drag){const n=t=>{t.preventDefault(),t.stopPropagation(),i?V(t,e.id):F(t,e.id),r.CyreLog.debug(`Mouse down detected on carousel ${e.id}`)};t.container.addEventListener("mousedown",n,{passive:!1});t.container.querySelectorAll(".holo").forEach(((t,i)=>{t.addEventListener("click",(n=>{e.io.accordionMode||(n.preventDefault(),n.stopPropagation(),r.CyreLog.debug(`Slide ${i} clicked in carousel ${e.id}`),o.activate&&r.cyre.call(o.activate,[t,e]))}),{passive:!1})}))}if(e.io.drag){const o=t=>{t.preventDefault(),t.stopPropagation(),i?V(t,e.id):F(t,e.id),r.CyreLog.debug(`Touch start detected on carousel ${e.id}`)};t.container.addEventListener("touchstart",o,{passive:!1})}if(e.io.wheel&&!i){const o=t=>{t.preventDefault(),t.stopPropagation(),((e,t)=>{e.preventDefault();const o=M[t]?.getVirtual;o?e.deltaY<0?R(o):e.deltaY>0&&b(o):r.CyreLog.error(`Cannot handle wheel: Carousel ${t} not found`)})(t,e.id),r.CyreLog.debug(`Wheel event detected on carousel ${e.id}`)};t.carousel.addEventListener("wheel",o,{passive:!1})}const n=t.carousel.querySelector(".holo-prev"),a=t.carousel.querySelector(".holo-next");n&&n.addEventListener("click",(t=>{t.preventDefault(),t.stopPropagation(),o.prevSlide&&r.cyre.call(o.prevSlide,e)})),a&&a.addEventListener("click",(t=>{t.preventDefault(),t.stopPropagation(),o.nextSlide&&r.cyre.call(o.nextSlide,e)})),e.io.animate&&o.animate&&r.cyre.call(o.animate,e);const s=()=>{r.cyre.call(l.REFRESH_CAROUSEL,{virtual:e,shadow:t})};window.addEventListener("resize",s,{passive:!0}),window.addEventListener("orientationchange",s,{passive:!0})},ce=(e="")=>({...p,id:e}),le=(e,t={})=>{const o=e.id||`holo-${Date.now()}`;e.id=o;const i=e.getElementsByClassName("holo-container")[0];if(!i)throw console.error("@Holo: holo-container not found in:",o),new Error("Missing holo-container element");const n={carousel:e,container:i},a=((e="")=>({id:e,carousel:{},container:{},io:ce(e),title:null,description:null,duration:u,transitionTiming:h,transformX:0,transformY:0,transformZ:0,numberOfSlots:0,endOfSlide:0,endOfSlidePosition:0,item:{max:8,width:0,height:0,min:1},noOfChildren:0,startNumber:0,eventIds:$(e)}))(o);a.io={...a.io,...t,id:o};const s=n.carousel.clientWidth||0,d=n.carousel.clientHeight||0,c=n.container.clientWidth||0,l=n.container.clientHeight||0,m=n.container.children.length||0,f={...a,carousel:{width:s,height:d},container:{width:c,height:l},noOfChildren:m,startNumber:0,endOfSlidePosition:a.io.orientation?-Math.max(0,l-d):-Math.max(0,c-s)},g=`state_updated_${o}`;r.cyre.on(g,(e=>{})),r.cyre.action({id:g,throttle:16,detectChanges:!0});return{virtual:f,shadow:n,get getVirtual(){return{...this.virtual}},get getShadow(){return this.shadow},get getState(){return{virtual:this.getVirtual,shadow:this.getShadow}},get getDimensions(){return{car:{w:this.shadow.carousel.clientWidth||0,h:this.shadow.carousel.clientHeight||0},con:{w:this.shadow.container.clientWidth||0,h:this.shadow.container.clientHeight||0,x:this.virtual.transformX,y:this.virtual.transformY,z:this.virtual.transformZ}}},set setState(e){e&&(this.virtual={...this.virtual,...e},this.updateDOMTransform(),r.cyre.call(`state_updated_${o}`,this.virtual))},set setDimension(e){e&&(this.virtual={...this.virtual,...e},this.updateDOMDimensions())},set updateStyle(e){this.updateTransitionStyle(1===e)},updateDOMTransform(){this.shadow.container&&(this.shadow.container.style.transform=`translate3d(${this.virtual.transformX}px, ${this.virtual.transformY}px, ${this.virtual.transformZ}px)`)},updateDOMDimensions(){this.shadow.carousel&&(this.virtual.io.orientation?this.shadow.carousel.style.height=`${this.virtual.carousel.height}px`:this.shadow.carousel.style.width=`${this.virtual.carousel.width}px`)},updateTransitionStyle(e){this.shadow.container&&(e?(this.shadow.container.style.transitionDuration=`${this.virtual.duration}ms`,this.shadow.container.style.transitionTimingFunction=this.virtual.transitionTiming):(this.shadow.container.style.transitionDuration="0ms",this.shadow.container.style.transitionTimingFunction="linear"))}}},ue=(e,t={})=>{if(!e||!e.nodeType)return console.error("@Holo: Invalid DOM element provided"),null;e.id||(e.id=`holo-${Date.now()}-${Math.floor(1e4*Math.random())}`);try{M[e.id]=le(e,t),console.log("@Holo: Created carousel:",e.id);const o=he(e);return o&&o.id!==e.id&&(k(e.id,o.id),me(e.id,o.id)),t.accordionMode&&te(M[e.id].getVirtual,M[e.id].getShadow),t.deepLinking&&W(e.id),((e,t)=>{if(e)if(e.id&&"string"==typeof e.id){try{N(e.id,e.io)}catch(o){r.CyreLog.error(`Error initializing events for carousel ${e.id}:`,o)}e.io.accordionMode&&te(e,t),e.io.deepLinking&&W(e.id),e.io.enabled&&de(e,t),r.cyre.call(l.REFRESH_CAROUSEL,{virtual:e,shadow:t})}else r.CyreLog.error("@Holo: Virtual state has no valid ID",e);else r.CyreLog.error("@Holo: Major malfunctions - Virtual state is missing")})(M[e.id].getVirtual,M[e.id].getShadow),e.id}catch(o){return console.error("@Holo: Error creating carousel:",o),null}},he=e=>{let t=e.parentElement;for(;t;){if(t.classList.contains(y))return t;t=t.parentElement}return null},me=(e,t)=>{const o=M[e]?.getVirtual;if(!o)return;const i=document.getElementById(e);i&&(i.setAttribute("data-nested","true"),i.setAttribute("data-parent",t)),M[e].setState={...o,io:{...o.io,nestedMode:1,wheel:0}},r.CyreLog.info(`Applied nested carousel settings for ${e} (parent: ${t})`)},fe=[];let ge=!1;const pe=()=>(ge=!ge,r.CyreLog.info("Debug mode "+(ge?"enabled":"disabled")),ge),ye=()=>{ge&&Object.keys(M).forEach((e=>{const t=document.getElementById(e);if(!t)return;t.classList.add("holo-debug");let o=t.querySelector(".holo-debug-overlay");o||(o=document.createElement("div"),o.className="holo-debug-overlay",t.appendChild(o));const r=M[e].getVirtual;o.innerHTML=`\n      <div class="holo-debug-info">\n        <div>ID: ${e}</div>\n        <div>X: ${Math.round(r.transformX)}</div>\n        <div>Y: ${Math.round(r.transformY)}</div>\n        <div>End of Slide: ${r.endOfSlide}</div>\n        <div>Orientation: ${r.io.orientation?"Vertical":"Horizontal"}</div>\n      </div>\n    `}))},ve=()=>{document.querySelectorAll(".holo-debug-overlay").forEach((e=>{e.remove()})),document.querySelectorAll(".holo-debug").forEach((e=>{e.classList.remove("holo-debug")}))};function Ee(e,t={}){try{if(!M[e])return{ok:!1,data:`Carousel with ID ${e} not found`};const o=M[e].getVirtual,i=Object.entries(t).reduce(((e,[t,o])=>t in p?{...e,[t]:o}:(r.CyreLog.warn(`Invalid option ignored: ${t}`),e)),{});"animate"in i&&o.eventIds?.animate&&(r.cyre.forget(o.eventIds.animate),r.CyreLog.info(`Removed existing animation for carousel ${e}`)),"accordionMode"in i&&1===i.accordionMode&&se(e),"deepLinking"in i&&1===i.deepLinking&&J(e);const n={...o.io,...i};return M[e].setState={...M[e].getVirtual,io:n},N(e,n),r.CyreLog.info(`Carousel ${e} options updated successfully`),{ok:!0,data:n}}catch(o){return r.CyreLog.error("Error updating carousel options:",o),{ok:!1,data:o instanceof Error?o.message:"Unknown error"}}}function Se(){try{const e=Object.keys(M);if(0===e.length)return void r.CyreLog.info("No carousels to refresh");r.CyreLog.info(`Refreshing ${e.length} carousels`),r.cyre.call(l.REFRESH_SCREEN),e.forEach((e=>{try{if(!M[e]?.getShadow?.carousel)return void r.CyreLog.warn(`Missing DOM elements for carousel ${e}, skipping refresh`);if(!(M[e].getShadow.carousel.offsetWidth>0||M[e].getShadow.carousel.offsetHeight>0))return void r.CyreLog.warn(`Carousel ${e} not visible in DOM, skipping refresh`);r.cyre.call(l.REFRESH_CAROUSEL,M[e].getState)}catch(t){r.CyreLog.error(`Error refreshing carousel ${e}:`,t)}}))}catch(e){r.CyreLog.error("Error in global refresh:",e)}}r.CyreLog.info("%c HOLO - Initializing Holo Carousel v3.5.0 ","background: #022d5f; color: white; display: block;");const Ie="undefined"!=typeof window?new URLSearchParams(window.location.search):null;((e=!1)=>{if((e=>{ge=e,r.CyreLog.info("Debug mode "+(e?"enabled":"disabled"))})(e),e){(()=>{if(!ge)return;const e="holo-debug-styles";if(document.getElementById(e))return;const t=document.createElement("style");t.id=e,t.textContent="\n    .holo-debug {\n      position: relative;\n    }\n    \n    .holo-debug-overlay {\n      position: absolute;\n      top: 0;\n      left: 0;\n      background: rgba(0, 0, 0, 0.7);\n      color: #fff;\n      padding: 5px;\n      border-radius: 3px;\n      font-size: 10px;\n      z-index: 9999;\n      pointer-events: none;\n    }\n    \n    .holo-debug .holo-container {\n      outline: 1px solid rgba(255, 0, 0, 0.5);\n    }\n    \n    .holo-debug .holo {\n      outline: 1px dashed rgba(0, 255, 0, 0.5);\n    }\n  ",document.head.appendChild(t)})();const e=(()=>{if(!ge)return()=>{};const e=setInterval((()=>{ye()}),500);return()=>clearInterval(e)})();window.holoDebug={toggleDebugMode:pe,addDebugOverlays:ye,removeDebugOverlays:ve,getDatabaseState:()=>({...M}),stopMonitoring:e}}})(Ie?.has("debug")||!1),r.CyreLog.info("Initializing Holo event system"),r.cyre.on(l.STATE_BATCH_UPDATE,(e=>{if(!e||!e.id)return{id:l.ERROR_HANDLER,payload:{source:"state_batch_update",error:"Invalid batch update payload",data:e}};const{id:t,changes:o}=e,r=M[t]?.getVirtual;return r?(M[t].setState={...r,...o},{id:l.SNAP_TO_POSITION,payload:M[t].getVirtual}):{id:l.ERROR_HANDLER,payload:{source:"state_batch_update",error:`Carousel ${t} not found for batch update`,id:t}}})),r.cyre.on(l.STATE_UPDATE,(e=>{if(!e||!e.id||!e.property)return{id:l.ERROR_HANDLER,payload:{source:"state_update",error:"Invalid state update payload",data:e}};const{id:t,property:o,value:r}=e,i=M[t]?.getVirtual;return i?(M[t].setState={...i,[o]:r},["transformX","transformY"].includes(o)?{id:l.SNAP_TO_POSITION,payload:M[t].getVirtual}:void 0):{id:l.ERROR_HANDLER,payload:{source:"state_update",error:`Carousel ${t} not found for state update`,id:t}}})),r.cyre.on(l.INIT_DIMENSIONS,(e=>{if(!e||!e.id)return{id:l.ERROR_HANDLER,payload:{source:"init_dimensions",error:"Invalid init dimensions payload",data:e}};const{id:t}=e;if(!M[t])return{id:l.ERROR_HANDLER,payload:{source:"init_dimensions",error:`Carousel ${t} not found for dimension init`,id:t}};const o=M[t].getVirtual,i=M[t].getShadow;if(void 0!==document.visibilityState&&"visible"!==document.visibilityState)return r.CyreLog.info(`Deferring dimensions calculation for ${t} until DOM is visible`),void setTimeout((()=>r.cyre.call(l.INIT_DIMENSIONS,{id:t})),100);try{const e=S(o,i);if(e)return M[t].setDimension={...e},{id:l.SNAP_TO_POSITION,payload:e};setTimeout((()=>{r.cyre.call(l.INIT_DIMENSIONS,{id:t})}),300)}catch(n){return{id:l.ERROR_HANDLER,payload:{source:"dimension_calculation",id:t,error:n}}}})),r.cyre.on(l.REFRESH_CAROUSEL,(e=>{try{const{virtual:t,shadow:o}=e;if(!t?.id)return{id:l.ERROR_HANDLER,payload:{source:"refresh_carousel",error:"Invalid virtual state",data:{virtualId:t?.id}}};o.container.setAttribute("style","");const i=S(t,o);return i?(M[t.id].setDimension={...i},{id:l.SNAP_TO_POSITION,payload:i}):(setTimeout((()=>{r.cyre.call(l.REFRESH_CAROUSEL,M[t.id].getState)}),300),{id:l.ERROR_HANDLER,payload:{source:"refresh_carousel",error:"Failed to calculate dimensions",id:t.id}})}catch(t){return{id:l.ERROR_HANDLER,payload:{source:"refresh_carousel",error:t instanceof Error?t.message:"Unknown error"}}}})),r.cyre.on(l.REFRESH_SCREEN,(()=>{const e=Object.keys(M);r.CyreLog.info(`Refreshing ${e.length} carousels`),e.forEach((e=>{r.cyre.call(l.REFRESH_CAROUSEL,M[e].getState)}))})),r.cyre.on(l.NEXT_SLIDE,(e=>{if(!e?.id)return{id:l.ERROR_HANDLER,payload:{source:"next_slide",error:"Invalid virtual state in next slide"}};b(e)})),r.cyre.on(l.PREV_SLIDE,(e=>{if(!e?.id)return{id:l.ERROR_HANDLER,payload:{source:"prev_slide",error:"Invalid virtual state in previous slide"}};R(e)})),r.cyre.on(l.FIRST_SLIDE,(e=>{if(!e?.id)return{id:l.ERROR_HANDLER,payload:{source:"first_slide",error:"Invalid virtual state in first slide"}};O(e)})),r.cyre.on(l.LAST_SLIDE,(e=>{if(!e?.id)return{id:l.ERROR_HANDLER,payload:{source:"last_slide",error:"Invalid virtual state in last slide"}};T(e)})),r.cyre.on(l.GO_TO_SLIDE,(e=>{if(!e||!e.virtual||!e.virtual.id)return{id:l.ERROR_HANDLER,payload:{source:"go_to_slide",error:"Invalid payload for go to slide"}};_(e.virtual,e.index)})),r.cyre.on(l.ACTIVATE,(e=>{const[t,o]=e;if(!t||!o||!o.id)return{id:l.ERROR_HANDLER,payload:{source:"activate",error:"Invalid activate payload"}};L(t,o)})),r.cyre.on(l.ANIMATE_FORWARD,(e=>{e&&e.id&&A(e,!0)})),r.cyre.on(l.ANIMATE_BACKWARD,(e=>{e&&e.id&&A(e,!1)})),r.cyre.on(l.SNAP_TO_POSITION,(e=>({id:l.SNAP,payload:e}))),r.cyre.on(l.SNAP,(e=>{if(!e?.id)return{id:l.ERROR_HANDLER,payload:{source:"snap",error:"Invalid virtual state in SNAP event"}};r.CyreLog.info(`SNAP event for ${e.id}: transformX=${e.transformX}, transformY=${e.transformY}`);try{if(e.io.orientation&&(!e.item.height||isNaN(e.item.height)))return r.CyreLog.warn(`Carousel ${e.id} item height not calculated yet. Attempting to fix...`),void setTimeout((()=>{r.cyre.call(l.REFRESH_CAROUSEL,M[e.id].getState)}),100);if(!e.io.orientation&&(!e.item.width||isNaN(e.item.width)))return r.CyreLog.warn(`Carousel ${e.id} item width not calculated yet. Attempting to fix...`),void setTimeout((()=>{r.cyre.call(l.REFRESH_CAROUSEL,M[e.id].getState)}),100);M[e.id].updateStyle=1;const t=C(e);(isNaN(t.transformX)||isNaN(t.transformY))&&(r.CyreLog.error(`NaN transform values detected for ${e.id}: X=${t.transformX}, Y=${t.transformY}`),t.transformX=isNaN(t.transformX)?0:t.transformX,t.transformY=isNaN(t.transformY)?0:t.transformY),M[e.id].setState={...t};const o=document.getElementById(e.id);if(o){const e=o.querySelector(".holo-container");if(e){const o=isNaN(t.transformX)?0:t.transformX,i=isNaN(t.transformY)?0:t.transformY;e.style.transform=`translate3d(${o}px, ${i}px, 0px)`,r.CyreLog.debug(`Applied direct transform: translate3d(${o}px, ${i}px, 0px)`)}}return{id:l.TRANSFORM_COMPLETE,payload:{id:e.id,position:w(t)}}}catch(t){return{id:l.ERROR_HANDLER,payload:{source:"snap",error:t instanceof Error?t.message:"Error in SNAP event",id:e.id}}}})),r.cyre.on(l.TRANSFORM_COMPLETE,(e=>{})),r.cyre.on(l.ERROR_HANDLER,(e=>{const{source:t,error:o,id:i}=e;r.CyreLog.error(`Holo Error [${t}]:`,o),i&&M[i]&&"dimension_calculation"===t&&(r.CyreLog.info(`Attempting to recover ${i} via refresh`),setTimeout((()=>r.cyre.call(l.REFRESH_CAROUSEL,M[i].getState)),200))})),r.cyre.on(l.PERFORMANCE_MONITOR,(e=>{const{id:t}=e;if(!t||!M[t])return;const o=r.cyre.getPerformanceState();return o.stress>.8?{id:l.PERFORMANCE_OPTIMIZE,payload:{id:t,stress:o.stress,level:"high"}}:o.stress>.5?{id:l.PERFORMANCE_OPTIMIZE,payload:{id:t,stress:o.stress,level:"medium"}}:void 0})),r.cyre.on(l.PERFORMANCE_OPTIMIZE,(e=>{const{id:t,level:o}=e;if(!t||!M[t])return;const r=M[t].getVirtual;switch(o){case"high":M[t].setState={...r,io:{...r.io,animate:0,wheel:0,duration:Math.max(400,r.io.duration||0)}};break;case"medium":M[t].setState={...r,io:{...r.io,duration:Math.max(300,r.io.duration||0)}}}})),r.cyre.action([{id:l.STATE_UPDATE,detectChanges:!0,throttle:50},{id:l.STATE_BATCH_UPDATE,detectChanges:!0},{id:l.INIT_DIMENSIONS,throttle:100},{id:l.REFRESH_CAROUSEL,throttle:100},{id:l.REFRESH_SCREEN,throttle:200},{id:l.NEXT_SLIDE,throttle:300},{id:l.PREV_SLIDE,throttle:300},{id:l.FIRST_SLIDE},{id:l.LAST_SLIDE},{id:l.GO_TO_SLIDE,throttle:300},{id:l.ACTIVATE,throttle:300},{id:l.SNAP_TO_POSITION,throttle:50},{id:l.SNAP,throttle:50},{id:l.TRANSFORM_COMPLETE},{id:l.ERROR_HANDLER},{id:l.PERFORMANCE_MONITOR,interval:5e3,repeat:!0},{id:l.PERFORMANCE_OPTIMIZE,throttle:1e3}]),(()=>{r.CyreLog.info("Initializing touch system");try{r.cyre.on(i,(e=>{const{event:t,id:o,options:i={}}=e;if(!M[o]?.getVirtual)return void r.CyreLog.error(`No carousel found with ID: ${o}`);const n=M[o].getVirtual;if(0===n.io.drag&&0===n.io.swipe)return;const d=n.nestedLevel>0||!!n.parentId;d&&(e=>{P(e).forEach((e=>{document.getElementById(e)?.setAttribute("data-child-active","true")}))})(o);const c="touches"in t?t.touches[0].clientX:t.clientX,l="touches"in t?t.touches[0].clientY:t.clientY;return v.id=o,v.virtual=n,v.startX=c,v.startY=l,v.currentX=c,v.currentY=l,v.lastX=c,v.lastY=l,v.distanceX=0,v.distanceY=0,v.directionX=0,v.directionY=0,v.velocityX=0,v.velocityY=0,v.startTransformX=n.transformX,v.startTransformY=n.transformY,v.pressed=!0,v.startTime=performance.now(),v.orientation=!!n.io.orientation,v.targetElement=t.target,v.moved=!1,v.isNested=d,M[o].updateStyle=0,document.getElementById(o)?.classList.add("holo-touch-active"),{id:v.orientation?s:a,payload:v}})),r.cyre.on(a,(e=>{if(!e.pressed||!e.id||!e.virtual)return;const t=e.startX-e.currentX;e.currentX!==e.lastX&&(v.directionX=e.currentX<e.lastX?1:-1,v.lastX=e.currentX,v.moved=!0),v.distanceX=t;const o=e.startTransformX-t*e.multiplier,r={...e.virtual,transformX:o},i=C(r,!0);return M[e.id].setState=i,v.virtual=i,{id:d,payload:v}})),r.cyre.on(s,(e=>{if(!e.pressed||!e.id||!e.virtual)return;const t=e.startY-e.currentY;e.currentY!==e.lastY&&(v.directionY=e.currentY<e.lastY?1:-1,v.lastY=e.currentY,v.moved=!0),v.distanceY=t;const o=e.startTransformY-t*e.multiplier,r={...e.virtual,transformY:o},i=C(r,!0);return M[e.id].setState=i,v.virtual=i,{id:d,payload:v}})),r.cyre.on(d,(e=>{if(!e.pressed||!e.virtual)return;const t=performance.now()-e.startTime;v.velocityX=U(e.distanceX,t),v.velocityY=U(e.distanceY,t)})),r.cyre.on(n,(()=>{if(!v.id||!v.virtual)return;const e=performance.now()-v.startTime,t={id:v.id,virtual:v.virtual,targetElement:v.targetElement,distanceX:v.distanceX,distanceY:v.distanceY,directionX:v.directionX,directionY:v.directionY,velocityX:v.velocityX,velocityY:v.velocityY,orientation:v.orientation,startTime:v.startTime,moved:v.moved,isNested:v.isNested};var o;return document.getElementById(v.id)?.classList.remove("holo-touch-active"),v.isNested&&(o=v.id,P(o).forEach((e=>{document.getElementById(e)?.removeAttribute("data-child-active")}))),v.pressed=!1,{id:c,payload:{touchState:t,timeElapsed:e}}})),r.cyre.on(c,(e=>{const{touchState:t,timeElapsed:o}=e;if(!t.id||!t.virtual)return;const i=t.id,n=t.virtual,a=t.targetElement,s=t.orientation?t.velocityY:t.velocityX,d=Math.abs(s),c=t.orientation?t.directionY:t.directionX,l=n.eventIds||{nextSlide:`next_slide_${i}`,prevSlide:`prev_slide_${i}`,snap:`snap_${i}`,activate:`activate_${i}`};M[i].updateStyle=1;try{if(d>.5&&t.moved&&0!==n.io.swipe){if(r.CyreLog.info(`Swipe detected: direction=${c}, velocity=${d}`),c>0)return{id:l.nextSlide,payload:n};if(c<0)return{id:l.prevSlide,payload:n}}else if(B(o)&&!t.moved&&a&&n.io.onClick){const e=a.closest(".holo");if(e)return{id:l.activate,payload:[e,n]}}if(n.io.snap)return{id:l.snap,payload:n};const e=C(n,!1);M[i].setState=e}catch(u){return r.CyreLog.error("Error in touch end processing:",u),{id:l.snap,payload:n}}})),r.cyre.action([{id:i,throttle:50},{id:a},{id:s},{id:d,throttle:100},{id:n,throttle:50},{id:c}]),function(){const e=e=>{if(v.pressed&&v.id){if(e.preventDefault(),"touches"in e&&e.touches.length>0)v.currentX=e.touches[0].clientX,v.currentY=e.touches[0].clientY;else{if(!("clientX"in e))return void t(e);v.currentX=e.clientX,v.currentY=e.clientY}r.cyre.call(v.orientation?s:a,v)}},t=e=>{v.pressed&&(e.preventDefault(),r.cyre.call(n))};document.addEventListener("mousemove",e,{passive:!1}),document.addEventListener("touchmove",e,{passive:!1}),document.addEventListener("mouseup",t,{passive:!1}),document.addEventListener("touchend",t,{passive:!1}),document.addEventListener("touchcancel",t,{passive:!1}),document.addEventListener("mouseleave",t,{passive:!1})}()}catch(e){r.CyreLog.error("Error during touch system initialization:",e)}})(),r.CyreLog.info("Initializing performance monitoring"),r.cyre.on("global_performance_check",(()=>{const e=r.cyre.getPerformanceState(),t={timestamp:Date.now(),stress:e.stress,totalProcessingTime:e.totalProcessingTime,frameRate:e.stress>.5?30-Math.floor(20*e.stress):60,carouselCount:Object.keys(M).length};fe.push(t),fe.length>2*g&&fe.splice(0,fe.length-g);const o=Object.keys(M);e.stress>m?o.forEach((t=>{r.cyre.call(l.PERFORMANCE_OPTIMIZE,{id:t,stress:e.stress,level:"high"})})):e.stress>f&&o.forEach((t=>{r.cyre.call(l.PERFORMANCE_OPTIMIZE,{id:t,stress:e.stress,level:"medium"})}))})),r.cyre.on(l.PERFORMANCE_OPTIMIZE,(e=>{const{id:t,level:o}=e;if(!t||!M[t])return;const i=M[t].getVirtual;switch(o){case"high":M[t].setState={...i,io:{...i.io,animate:0,wheel:0,duration:Math.max(400,i.io.duration||0)}},r.CyreLog.info(`Applied high-level optimizations to carousel ${t}`);break;case"medium":M[t].setState={...i,io:{...i.io,duration:Math.max(300,i.io.duration||0)}},r.CyreLog.info(`Applied medium-level optimizations to carousel ${t}`)}})),r.cyre.action([{id:"global_performance_check",interval:5e3,repeat:!0,log:!1},{id:l.PERFORMANCE_OPTIMIZE,throttle:1e3}]),r.cyre.call("global_performance_check"),r.cyre.action({id:"window-resize",throttle:200,log:!1}),r.cyre.on("window-resize",(()=>({id:l.REFRESH_SCREEN,payload:null}))),window.addEventListener("resize",(()=>{r.cyre.call("window-resize")}),{passive:!0});const we={INIT:function(e=y){return r.CyreLog.info(`Initializing Holo with selector: ${e}`),z(),ae(),window.addEventListener("load",(()=>{Se(),setTimeout((()=>{(async()=>{const e=Object.keys(M);r.CyreLog.info(`Force refreshing ${e.length} carousels`);for(const t of e)await I(t)})().then((()=>{r.CyreLog.info("Force refresh completed successfully")}))}),300)})),e},AUTO:(e=y)=>{console.log("@holo: auto activated:",e);const t=document.getElementsByClassName(e);if(0===t.length)return void console.log("@Holo: carousel structure not found");const o=[];Array.from(t).forEach((e=>{try{const t=e;if(he(t))return;const r=ue(t,{});r&&o.push(r)}catch(t){r.CyreLog.error("Error auto-initializing carousel:",t)}})),Array.from(t).forEach((e=>{try{const t=e;if(o.includes(t.id))return;if(!he(t))return;const r=ue(t,{nestedMode:1});r&&o.push(r)}catch(t){r.CyreLog.error("Error auto-initializing nested carousel:",t)}})),r.CyreLog.info(`Auto-initialized ${o.length} carousels`)},BUILD:ue,carousel:Ee,dimensions:function(e){return M[e]?M[e].getDimensions:(r.CyreLog.warn(`Carousel with ID ${e} not found`),null)},getState:function(e){return M[e]?M[e].getVirtual:(r.CyreLog.warn(`Carousel with ID ${e} not found`),null)},getPosition:function(e){return M[e]?w(M[e].getVirtual):0},next:function(e){M[e]?b(M[e].getVirtual):r.CyreLog.warn(`Carousel with ID ${e} not found`)},prev:function(e){M[e]?R(M[e].getVirtual):r.CyreLog.warn(`Carousel with ID ${e} not found`)},first:function(e){M[e]?O(M[e].getVirtual):r.CyreLog.warn(`Carousel with ID ${e} not found`)},last:function(e){M[e]?T(M[e].getVirtual):r.CyreLog.warn(`Carousel with ID ${e} not found`)},goTo:function(e,t){M[e]?_(M[e].getVirtual,t):r.CyreLog.warn(`Carousel with ID ${e} not found`)},refresh:Se,getPerformanceHistory:()=>fe.slice(-10),optimize:function(e,t){((e,t)=>{if(!e||!M[e])return void r.CyreLog.warn(`Cannot optimize carousel ${e}: not found`);const o=M[e].getVirtual;switch(t){case"aggressive":M[e].setState={...o,io:{...o.io,animate:0,wheel:0,drag:0,swipe:0,duration:Math.max(500,o.io.duration||0)}},r.CyreLog.info(`Applied aggressive optimizations to carousel ${e}`);break;case"medium":M[e].setState={...o,io:{...o.io,animate:0,wheel:0,duration:Math.max(400,o.io.duration||0)}},r.CyreLog.info(`Applied medium optimizations to carousel ${e}`);break;case"light":M[e].setState={...o,io:{...o.io,duration:Math.max(300,o.io.duration||0)}},r.CyreLog.info(`Applied light optimizations to carousel ${e}`)}})(e,t)},handleTouchStart:F,makeNested:function(e,t){if(!M[e]||!M[t])return void r.CyreLog.error(`Invalid carousel IDs for nesting: ${e}, ${t}`);k(e,t),Ee(e,{nestedMode:1,wheel:0});const o=document.getElementById(e);o&&(o.setAttribute("data-nested","true"),o.setAttribute("data-parent",t)),r.CyreLog.info(`Carousel ${e} is now nested inside ${t}`)},getNestedInfo:function(e){return{isNested:!!Y(e),parent:Y(e),children:X(e),ancestors:P(e),descendants:H(e)}},toAccordion:se,toCarousel:e=>{const t=M[e]?.getVirtual,o=M[e]?.getShadow;if(!t||!o)return void r.CyreLog.error(`Cannot convert accordion ${e} to carousel: not found`);M[e].setState={...t,io:{...t.io,accordionMode:0},accordionState:void 0,accordionOptions:void 0},o.carousel.removeAttribute("data-mode"),o.carousel.removeAttribute("data-orientation"),o.container.style.height="",o.container.style.width="";Array.from(o.container.children).forEach((e=>{e.classList.remove("accordion-open","accordion-closed");const t=e.querySelector(".accordion-content");t&&(t.style.height="",t.style.width="",t.style.overflow="",t.style.transition="",Array.from(t.children).forEach((t=>{e.appendChild(t)})),t.remove());const o=e.querySelector(".accordion-header");o&&o.remove()})),r.cyre.call(l.REFRESH_CAROUSEL,M[e].getState)},toggleAccordion:(e,t)=>{re(e,t)},openAccordion:(e,t)=>{const o=M[e]?.getVirtual;o&&o.accordionState?o.accordionState.openPanels.includes(t)||re(e,t):r.CyreLog.error(`Invalid accordion state for ${e}`)},closeAccordion:(e,t)=>{const o=M[e]?.getVirtual;o&&o.accordionState?o.accordionState.openPanels.includes(t)&&re(e,t):r.CyreLog.error(`Invalid accordion state for ${e}`)},enableDeepLinking:J,disableDeepLinking:e=>{q[e]&&(q[e].enabled=!1)},getDeepLink:e=>{const t=M[e]?.getVirtual;if(!t)return"";const o=Q(t);return K(e,o)},navigateToDeepLink:e=>{window.location.hash=e},EVENTS:l};return"undefined"!=typeof window&&(window.Holo=we),we}));
//# sourceMappingURL=holo.js.map
