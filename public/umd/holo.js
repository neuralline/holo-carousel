!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).Holo=t()}(this,(function(){"use strict";var e,t={exports:{}};function r(){return e||(e=1,function(e){const t={reset:"[0m",magenta:"[35m",magentaBright:"[95m",red:"[31m",redBright:"[91m",green:"[32m",greenBright:"[92m",cyan:"[36m",cyanBright:"[96m",yellow:"[33m",yellowBright:"[93m",white:"[37m",whiteBright:"[97m",blue:"[34m",blueBright:"[94m",bgRed:"[41m",bgYellow:"[43m",bgBlue:"[44m",bold:"[1m",dim:"[2m",italic:"[3m",underline:"[4m"},r={DEBUG:["dim","cyan"],INFO:["blue","bold"],WARN:["yellowBright","bold"],ERROR:["redBright","bold"],SUCCESS:["greenBright","bold"]},i="undefined"!=typeof process&&process.versions&&process.versions.node,o="undefined"!=typeof window,n={DEBUG:0,INFO:1,WARN:2,ERROR:3,SUCCESS:1},a=(e,r,a)=>(s,l=!0,c=!1)=>{if(n[e]<n.DEBUG)return;const d=(u=e,m=s,`${l?`[${(new Date).toISOString()}]`:""} ${u}: ${m instanceof Error?`${m.message}\n${m.stack}`:"object"==typeof m?JSON.stringify(m,null,2):String(m)}`);var u,m;if(c||o){const t="ERROR"===e?"color: red; font-weight: bold":"WARN"===e?"color: orange; font-weight: bold":"SUCCESS"===e?"color: green; font-weight: bold":"INFO"===e?"color: blue":"color: gray";console[a](`%c${d}`,t)}else if(i){const e=r.reduce(((e,r)=>`${t[r]}${e}`),d);process.stdout.write(`${e}${t.reset}\n`)}},s={error:a("ERROR",r.ERROR,"error"),warn:a("WARN",r.WARN,"warn"),info:a("INFO",r.INFO,"log"),debug:a("DEBUG",r.DEBUG,"debug"),success:a("SUCCESS",r.SUCCESS,"log")},l=e=>{const t=new WeakMap;return(...r)=>{const i=r[0];return"object"==typeof i&&null!==i?(t.has(i)||t.set(i,e(...r)),t.get(i)):e(...r)}},c=(e,...t)=>t.reduce(((e,t)=>t(e)),e),d=(e,t)=>{if(Object.is(e,t))return!0;if("object"!=typeof e||"object"!=typeof t||null===e||null===t)return!1;if(Array.isArray(e)&&Array.isArray(t))return e.length===t.length&&e.every(((e,r)=>d(e,t[r])));const r=Object.keys(e),i=Object.keys(t);return r.length===i.length&&r.every((r=>d(e[r],t[r])))},u={RECUPERATION:6e4,MAX_TIMEOUT:Math.pow(2,31)-1},m="@cyre: System is offline",h="@cyre: System is online",p="@cyre: Welcome! How can I assist you?",f="Failed to prepare action: invalid configuration",g="Failed to execute action: runtime error",v="Action skipped: no payload changes detected",y="Failed to create channel: configuration error",E="Channel created successfully",S="Invalid channel data definition",I="Channel ID is required",T="Channel type is required",b="Invalid channel type specified",A="Invalid channel structure: check configuration",w="Invalid subscription parameters provided",_="Subscriber exists - updating configuration",O="Successfully subscribed to event",R="Invalid event handler provided",k="Subscription failed: check configuration",D="Call failed: system is offline",C="Call failed: invalid action ID",$="Call failed: action not responding",M="Dispatch failed: no subscriber found for this type",N="Q0.0U0.0A0.0N0.0T0.0U0.0M0 - I0.0N0.0C0.0E0.0P0.0T0.0I0.0O0.0N0.0S0-- ",x={MIN:50,BASE:200,MAX:1e3,RECOVERY:2e3},L={HIGH:.9,CRITICAL:.95},P={MAX_CPU:80,MAX_MEMORY:85,MAX_EVENT_LOOP:50,MAX_CALL_RATE:1e3},H={system:{cpu:0,memory:0,eventLoop:0,isOverloaded:!1},breathing:{breathCount:0,currentRate:x.BASE,lastBreath:Date.now(),stress:0,isRecuperating:!1,recuperationDepth:0,pattern:"NORMAL",nextBreathDue:Date.now()+x.BASE},performance:{callsTotal:0,callsPerSecond:0,lastCallTimestamp:Date.now(),activeQueues:{critical:0,high:0,medium:0,low:0,background:0},queueDepth:0},stress:{cpu:0,memory:0,eventLoop:0,callRate:0,combined:0},lastUpdate:Date.now(),inRecuperation:!1,hibernating:!1,activeFormations:0},X=()=>{const e=new Map;return{get:t=>e.get(t),set:(t,r)=>{e.set(t,r),e.size>1e3&&Array.from(e.keys()).slice(0,e.size-1e3).forEach((t=>e.delete(t)))},forget:t=>e.delete(t),clear:()=>e.clear(),getAll:()=>Array.from(e.values()),size:()=>e.size}},F=X();F.set("quantum",H);const U=l(((e,t)=>{const r=Math.min(1,(e.cpu||0)/(.7*P.MAX_CPU)),i=Math.min(1,(e.memory||0)/(.7*P.MAX_MEMORY)),o=Math.min(1,(e.eventLoop||0)/(.7*P.MAX_EVENT_LOOP)),n=Math.min(1,(t.callsPerSecond||0)/(.7*P.MAX_CALL_RATE)),a=Math.max(r,i,o,n);return{cpu:r,memory:i,eventLoop:o,callRate:n,combined:Math.min(1,(r+i+o+n+2*a)/6)}})),Y=e=>{if(e>=L.CRITICAL)return x.RECOVERY;const t=Math.exp(e)-1;return Math.max(x.MIN,Math.min(x.MAX,x.BASE*(1+t)))},B={inRecuperation:!1,hibernating:!1,activeFormations:0,recuperationInterval:void 0,get:()=>{const e=F.get("quantum");return Object.freeze({...e,inRecuperation:B.inRecuperation,hibernating:B.hibernating,activeFormations:B.activeFormations})},update:e=>{const t={...F.get("quantum"),...e,lastUpdate:Date.now(),inRecuperation:e.inRecuperation??B.inRecuperation,hibernating:e.hibernating??B.hibernating,activeFormations:e.activeFormations??B.activeFormations};return(e.system||e.performance)&&(t.stress=U(t.system,t.performance)),F.set("quantum",t),t},updateBreath:e=>{const t=F.get("quantum"),r=U(e,t.performance),i=Date.now(),o={...t.breathing,breathCount:t.breathing.breathCount+1,lastBreath:i,stress:r.combined,currentRate:Y(r.combined),nextBreathDue:i+Y(r.combined),isRecuperating:r.combined>L.HIGH,recuperationDepth:Math.min(1,r.combined),pattern:r.combined>L.HIGH?"RECOVERY":"NORMAL"};return B.update({system:e,breathing:o,stress:r,inRecuperation:o.isRecuperating})},recordCall:(e="medium")=>{const t=F.get("quantum"),r=Date.now(),i=r-t.performance.lastCallTimestamp>=1e3?1:t.performance.callsPerSecond+1,o={...t.performance,callsTotal:t.performance.callsTotal+1,callsPerSecond:i,lastCallTimestamp:r,activeQueues:{...t.performance.activeQueues,[e]:t.performance.activeQueues[e]+1},queueDepth:t.performance.queueDepth+1};return B.update({performance:o})},isHealthy:()=>{const e=F.get("quantum");return!e.breathing.isRecuperating&&e.stress.combined<L.HIGH},shouldAllowCall:e=>{const t=F.get("quantum");return t.breathing.isRecuperating?"critical"===e:t.stress.combined<L.HIGH||"critical"===e||"high"===e},reset:()=>{B.inRecuperation=!1,B.hibernating=!1,B.activeFormations=0,F.set("quantum",H)},forget:e=>{F.forget(e)}},V=X(),q=X(),W=X(),j=X(),z=X(),G=e=>{const t=z.get(e);t?.intervalId&&clearInterval(t.intervalId),z.forget(e),j.forget(e)},Q=e=>{if(!e?.id)throw new Error("IO must have an id");try{const t={...e,timestamp:Date.now(),type:e.type||e.id};G(e.id),V.set(e.id,t),z.set(e.id,{lastExecutionTime:Date.now(),executionCount:0,errors:[]}),e.detectChanges&&j.set(e.id,e.payload),B.recordCall(e.priority?.level)}catch(t){throw s.error(`Failed to set IO: ${t instanceof Error?t.message:String(t)}`),t}},Z=e=>V.get(e),K=e=>(G(e),V.forget(e)),J=()=>{V.getAll().forEach((e=>{e.id&&G(e.id)})),j.clear(),z.clear(),V.clear(),B.reset()},ee=(e,t)=>{const r=j.get(e);return!d(t,r)},te=e=>j.get(e),re=e=>z.get(e),ie=e=>{if(!e?.id||!e?.fn)throw new Error("Invalid subscriber format");q.set(e.id,e)},oe=e=>q.get(e),ne=()=>q.clear(),ae=e=>{e.id&&W.set(e.id,e)},se=e=>W.get(e),le=e=>{const t=W.get(e);return t?.timeoutId&&clearTimeout(t.timeoutId),W.forget(e)},ce=()=>{W.getAll().forEach((e=>{e.timeoutId&&clearTimeout(e.timeoutId)})),W.clear()},de=()=>W.getAll(),ue=()=>W.getAll().filter((e=>"active"===e.status)),me=e=>e.type&&e.id?{...e,ok:!0,status:"active"}:{...e,ok:!1,done:!1,status:"error",error:"Missing required fields: type or id"},he=e=>e.detectChanges?ee(e.id,e.payload)?e:{...e,ok:!0,done:!0,status:"skipped",skipped:!0,skipReason:v}:e,pe=e=>{if(e.skipped||"error"===e.status)return e;try{const t=oe(e.id);if(!t)throw new Error("No subscriber found");const r=t.fn(e.payload);return r&&"object"==typeof r&&"id"in r?{...e,ok:!0,done:!0,status:"completed",intraLink:{id:r.id,payload:r.payload}}:{...e,ok:!0,done:!0,status:"completed"}}catch(t){return s.error(`${g}: ${t}`),{...e,ok:!1,done:!1,status:"error",error:t instanceof Error?t.message:String(t)}}},fe=(e,t)=>{if(!e)return s.error(f),{id:"",type:"",ok:!1,done:!1,status:"error",error:f};try{return c((e=>{try{if(!e)throw new Error(f);return{...e,ok:!0,done:!1,status:"pending",timestamp:Date.now()}}catch(t){return{id:"",type:"",ok:!1,done:!1,status:"error",error:f}}})(e),me,he,pe,(e=>{return"error"===e.status?e:((t=e).log&&("error"===t.status?s.error(t):(t.status,s.info(t))),t);var t}),(e=>{return"error"===e.status?e:((t=e).ok&&!t.skipped&&Q({...t,timestamp:Date.now()}),t);var t}))}catch(r){return s.error(`Action processing failed: ${r}`),{...e,ok:!1,done:!1,status:"error",error:r instanceof Error?r.message:String(r)}}},ge=l((e=>e?e.id?e.type||e.id?e.type&&"string"!=typeof e.type?{isValid:!1,error:b}:{isValid:!0}:{isValid:!1,error:T}:{isValid:!1,error:I}:{isValid:!1,error:A})),ve=(e,t)=>{try{if(!("object"==typeof(o=e)&&null!==o&&"id"in o&&"string"==typeof o.id&&o.id.length>0))return s.error(A),{ok:!1,message:A};const n=ge(e);if(!n.isValid)return s.error(n.error),{ok:!1,message:n.error};if(r=e,(i=t)&&!Object.entries(i).filter((([e,t])=>t(void 0).required)).map((([e])=>e)).every((e=>e in r)))return s.error(S),{ok:!1,message:S};const a=((e,t)=>{try{const r={...e},i=[];for(const[o,n]of Object.entries(e)){const e=t[o];if(!e){r[o]=n;continue}const a=e(n);if(!a.ok){if(a.required)return{ok:!1,message:`Required field '${o}' validation failed: ${a.message}`,payload:r};i.push(`${o}: ${a.message}`)}r[o]=a.payload}for(const[o,n]of Object.entries(t))if(n(void 0).required&&!(o in e))return{ok:!1,message:`Missing required field: ${o}`,payload:r};return i.length>0?{ok:!1,message:i.join("; "),payload:r}:{ok:!0,payload:r}}catch(r){const e=r instanceof Error?r.message:String(r);return s.error(`Data definition processing failed: ${e}`),{ok:!1,message:S}}})(e,t);if(!a.ok)return a;const l=(e=>{const t=Date.now();return{...e,type:e.type||e.id,timestamp:t,interval:e.interval||0,timeOfCreation:e.timeOfCreation||t}})({...a.payload,id:e.id});return s.success(E),{ok:!0,message:E,payload:l}}catch(n){const e=n instanceof Error?n.message:String(n);return s.error(`Channel processing failed: ${e}`),{ok:!1,message:y}}var r,i,o},ye=(e,t)=>{try{const o=(i=t,(r=e)&&"string"==typeof r?"function"!=typeof i?{ok:!1,message:R,error:{code:"INVALID_HANDLER",message:"Event handler must be a function"}}:{ok:!0,message:O,subscriber:{id:r.trim(),fn:i}}:{ok:!1,message:b,error:{code:"INVALID_TYPE",message:`Type must be a non-empty string, received: ${r}`}});if(!o.ok||!o.subscriber)return s.error(o.error||o.message),{ok:!1,message:o.message};const{subscriber:n}=o;return oe(n.id)&&s.info(`${n.id}: ${_}`),ie(n),s.info(`${O}: ${n.id}`),{ok:!0,message:`${O}: ${n.id}`}}catch(o){const e=o instanceof Error?o.message:String(o);return s.error(`Failed to add subscriber: ${e}`),{ok:!1,message:k}}var r,i},Ee=(e,t)=>Array.isArray(e)?(e=>{try{const t=e.map((e=>{if(!e.id||!e.fn)return s.error(`Invalid subscriber format: ${JSON.stringify(e)}`),!1;try{return ie(e),!0}catch(t){return s.error(`Failed to add subscriber ${e.id}: ${t}`),!1}})).filter(Boolean).length,r=e.length;return 0===t?{ok:!1,message:`Failed to add any subscribers out of ${r}`}:{ok:!0,message:`Successfully added ${t} out of ${r} subscribers`}}catch(t){const e=t instanceof Error?t.message:String(t);return s.error(`Batch subscription failed: ${e}`),{ok:!1,message:k}}})(e):"string"==typeof e&&t?ye(e,t):(s.error(w),{ok:!1,message:w}),Se=async e=>{if(!e||!e.id)return;const t=performance.now(),r=se(e.id);if(r&&r.isActive)try{await e.callback();const i=performance.now()-t;r.metrics.totalExecutions++,r.metrics.successfulExecutions++,r.metrics.lastExecutionTime=i,r.metrics.longestExecutionTime=Math.max(r.metrics.longestExecutionTime,i),r.metrics.shortestExecutionTime=Math.min(r.metrics.shortestExecutionTime,i),r.metrics.averageExecutionTime=(r.metrics.averageExecutionTime*(r.metrics.totalExecutions-1)+i)/r.metrics.totalExecutions,r.executionCount++,r.lastExecutionTime=Date.now(),!0!==r.repeat&&"number"==typeof r.repeat&&(r.repeat=r.repeat-1),ae(r),!0===r.repeat||"number"==typeof r.repeat&&r.repeat>0?Te(r):le(r.id)}catch(i){const t=se(e.id);t&&(t.metrics.failedExecutions++,ae(t)),s.error(`Timer execution failed: ${i}`)}},Ie=e=>{if(!e||!e.id)return;const t=e.duration>u.RECUPERATION?u.RECUPERATION:Math.max(e.duration/10,1e3);let r,i=Date.now();const o=()=>{const n=se(e.id);if(!n||!n.isActive)return void clearTimeout(r);const a=Date.now(),s=B.get(),l=1+(s.stress?.combined||0);if(a-i>t||Math.abs(l-1)>.1){const e=n.originalDuration-n.executionCount*u.MAX_TIMEOUT;n.duration=Math.min(e,u.MAX_TIMEOUT)*l,n.nextExecutionTime=a+n.duration,ae(n),i=a}s.hibernating||"active"!==n.status||(r=setTimeout(o,t),n.recuperationInterval=r,ae(n))};return r=setTimeout(o,t),r},Te=e=>{if(!e||!e.id)return;const t=B.get();if(t.hibernating)return;const r=Date.now(),i=1+(t.stress?.combined||0),o=se(e.id);if(!o||!o.isActive)return;if(o.executionCount>1e4)return s.error("Maximum execution count exceeded"),void le(o.id);let n=o.duration*i;if(o.isInRecuperation){const e=o.originalDuration-o.executionCount*u.MAX_TIMEOUT;n=Math.min(e*i,u.MAX_TIMEOUT),o.duration=n,o.duration>u.RECUPERATION&&(o.recuperationInterval&&clearTimeout(o.recuperationInterval),o.recuperationInterval=Ie(o)),e<=u.MAX_TIMEOUT&&(o.isInRecuperation=!1)}else o.duration=n;o.nextExecutionTime=r+o.duration,o.timeoutId&&clearTimeout(o.timeoutId);const a="undefined"!=typeof process&&"test"===process.env.NODE_ENV;o.timeoutId=a?setTimeout((()=>Se(o)),o.duration):o.duration<25?((e,t)=>{if("undefined"!=typeof process&&"test"===process.env.NODE_ENV)return setTimeout(e,t);const r=process.hrtime(),i=()=>{const[o,n]=process.hrtime(r),a=1e3*o+n/1e6;if(a>=t)e();else{const e=t-a;e<1?setImmediate(i):e<25?setTimeout(i,0):setTimeout(i,Math.floor(e/2))}};return setTimeout(i,0)})((()=>Se(o)),o.duration):setTimeout((()=>Se(o)),o.duration),ae(o)},be=(e,t,r,i=crypto.randomUUID())=>{try{const n=((e,t,r,i)=>{if(!e||"number"!=typeof t||"function"!=typeof r)throw new Error("Invalid formation parameters");const o=Date.now(),n=t>=u.MAX_TIMEOUT,a=B.get(),s=1+(a.stress?.combined||0),l={id:e,startTime:o,duration:n?u.MAX_TIMEOUT:t*s,originalDuration:t,callback:r,repeat:i,executionCount:0,lastExecutionTime:0,nextExecutionTime:o+(n?u.MAX_TIMEOUT:t*s),isInRecuperation:n,status:"active",isActive:!0,metrics:{totalExecutions:0,successfulExecutions:0,failedExecutions:0,averageExecutionTime:0,lastExecutionTime:0,longestExecutionTime:0,shortestExecutionTime:1/0,missedExecutions:0}};return n&&(l.recuperationInterval=Ie(l)),l})(i,"number"==typeof e?e:24*((o=e).days||0)*60*60*1e3+60*(o.hours||0)*60*1e3+60*(o.minutes||0)*1e3+1e3*(o.seconds||0)+(o.milliseconds||0),t,r);return ae(n),Te(n),{kind:"ok",value:n}}catch(n){return{kind:"error",error:n instanceof Error?n:new Error("Timer creation failed")}}var o},Ae=e=>{if(e){const t=se(e);t&&(t.timeoutId&&clearTimeout(t.timeoutId),t.recuperationInterval&&clearTimeout(t.recuperationInterval),t.status="paused",t.isActive=!1,ae(t))}else de().forEach((e=>{e.timeoutId&&clearTimeout(e.timeoutId),e.recuperationInterval&&clearTimeout(e.recuperationInterval),e.status="paused",e.isActive=!1,ae(e)}))},we=e=>{if(!B.get().hibernating)if(e){const t=se(e);t&&"paused"===t.status&&(t.status="active",t.isActive=!0,ae(t),Te(t))}else de().forEach((e=>{"paused"===e.status&&(e.status="active",e.isActive=!0,ae(e),Te(e))}))},_e=()=>{B.update({hibernating:!0}),de().forEach((e=>{e.timeoutId&&clearTimeout(e.timeoutId),e.recuperationInterval&&clearTimeout(e.recuperationInterval)})),ce()},Oe={id:(e="")=>"string"==typeof e?{ok:!0,payload:e}:{ok:!1,payload:null,message:`action.id must be a string. Received '${e}'`,required:!0},type:(e="")=>"string"==typeof e?{ok:!0,payload:e}:{ok:!1,payload:null,message:`action.type must be a string. Received '${e}'`,required:!0},payload:(e=null)=>({ok:!0,payload:e}),interval:(e=0)=>Number.isInteger(e)?{ok:!0,payload:e}:{ok:!1,payload:0,message:`'${e}' invalid action.interval value`,required:!1},timeOfCreation:(e=0)=>Number.isInteger(e)?{ok:!0,payload:e}:{ok:!1,payload:0,message:`'${e}' invalid @cyre.call time of creation value`,required:!0},repeat:(e=0)=>Number.isInteger(e)?{ok:!0,payload:e}:{ok:!1,payload:0,message:`'${e}' invalid action.repeat value`,required:!1},message:(e="")=>"string"==typeof e?{ok:!0,payload:e}:{ok:!1,payload:"",message:`action.message must be a string. Received '${e}'`,required:!1},group:(e="")=>"string"==typeof e?{ok:!0,payload:e}:{ok:!1,payload:null,message:`'${e}' invalid action.group value`,required:!1},callback:(e="")=>"string"==typeof e?{ok:!0,payload:e}:{ok:!1,payload:null,message:`'${e}' invalid action.callback value`,required:!1},log:(e=!1)=>"boolean"==typeof e?{ok:!0,payload:e}:{ok:!1,payload:!1,message:`'${e}' invalid action.log value`,required:!1},middleware:(e="")=>"string"==typeof e?{ok:!0,payload:e}:{ok:!1,payload:null,message:`'${e}' invalid action.middleware value`,required:!1},throttle:(e=0)=>Number.isInteger(e)?{ok:!0,payload:e}:{ok:!1,payload:100,message:`'${e}'  action.throttle value must be a number`,required:!1},debounce:(e=0)=>Number.isInteger(e)?{ok:!0,payload:e}:{ok:!1,payload:100,message:`'${e}'  action.debounce value must be a number`,required:!1},at:(e=0)=>({ok:!1,payload:e,message:`'${e}'  action.at is an experimental feature, not applied yet`,required:!1})},Re=function(e=crypto.randomUUID()){let t=!1;const r=async(e,t,r)=>{const i=be(t,(async()=>{B.isHealthy()&&await o({...e,timeOfCreation:performance.now(),payload:r??e.payload})}),e.repeat||!0,e.id);return"error"===i.kind?{ok:!1,payload:null,message:i.error.message}:{ok:!0,payload:null,message:`Scheduled with breathing-adjusted interval: ${Math.round(t)}ms`}},i=async(e,t)=>{const r=e.priority?.level||"medium";if(!B.shouldAllowCall(r)){const{stress:e}=B.get();return{ok:!1,payload:null,message:`System under high stress (${(100*e.combined).toFixed(1)}%). Try later.`}}return n(e,t)},o=async e=>{if(!e?.type)throw new Error("Invalid IO object");try{const r=oe(e.type)||oe(e.id);if(!r){const t=`${M} ${e.type}`;return s.error(t),{ok:!1,payload:null,message:t}}const i=performance.now(),o=fe({...e},r.fn);if(e.log&&s.info({...o,executionTime:performance.now()-i,timestamp:Date.now()}),o?.intraLink)try{const{id:e,payload:t}=o.intraLink;await a(e,t)}catch(t){s.error(`Linked action error: ${t}`)}return{ok:!0,payload:o,message:p}}catch(t){const e=t instanceof Error?t.message:String(t);return s.error(`Dispatch error: ${e}`),{ok:!1,payload:null,message:`Dispatch error: ${e}`}}},n=async(e,t)=>{try{if(e.throttle){const t=Date.now()-(re(e.id)?.lastExecutionTime||0);if(t<e.throttle)return{ok:!1,payload:null,message:`Throttled: ${e.throttle-t}ms remaining`}}const r=await o({...e,timeOfCreation:performance.now(),payload:t??e.payload});return B.recordCall(e.priority?.level),r}catch(r){return{ok:!1,payload:null,message:`Call failed: ${r instanceof Error?r.message:String(r)}`}}},a=async(e,o)=>{if(t)return{ok:!1,message:D,payload:null};if(!e?.trim())return{ok:!1,message:C,payload:null};const a=Z(e.trim());return a?(async(e,t)=>{if(!e)return{ok:!1,payload:null,message:"Invalid action"};const{breathing:o,stress:a}=B.get();if(o.isRecuperating&&"critical"!==e.priority?.level)return{ok:!1,payload:null,message:`System recuperating (${(100*o.recuperationDepth).toFixed(1)}% depth). Try later.`};if(e.interval){const i=e.interval*(1+a.combined);return r(e,i,t)}return a.combined>=L.HIGH?i(e,t):n(e,t)})(a,o):{ok:!1,payload:null,message:`${$}: ${e}`}},l=()=>{if(!t)try{de().forEach((e=>{e.timeoutId&&clearTimeout(e.timeoutId)})),_e(),ne(),J(),B.reset(),t=!0,"undefined"!=typeof process&&process.exit&&process.exit(0)}catch(e){s.error(`Failed to shutdown gracefully: ${e}`),"undefined"!=typeof process&&process.exit&&process.exit(1)}};return"undefined"!=typeof window?window.addEventListener("beforeunload",l):(process.on("SIGINT",l),process.on("SIGTERM",l),process.on("uncaughtException",(e=>{console.error("Uncaught Exception:",e),l()}))),{initialize:()=>(t=!1,be(x.BASE,(async()=>{const e=B.get();B.updateBreath({cpu:e.system.cpu,memory:e.system.memory,eventLoop:e.system.eventLoop,isOverloaded:e.system.isOverloaded})}),!0),we(),console.log("%c"+N,"background: rgb(151, 2, 151); color: white; display: block;"),{ok:!0,payload:200,message:p}),call:a,action:e=>{if(t)s.error(m);else try{if(Array.isArray(e))e.forEach((e=>{const t=ve({...e,type:e.type||e.id},Oe);t.ok&&t.payload&&Q(t.payload)}));else{const t=ve({...e,type:e.type||e.id},Oe);t.ok&&t.payload&&Q(t.payload)}}catch(r){s.error(`Action registration failed: ${r}`)}},on:Ee,shutdown:l,status:()=>(t?s.info({ok:!0,message:m}):s.info({ok:!0,message:h}),t),forget:e=>t?(s.error(D),!1):(Ae(e),K(e)),get:e=>{if(!t)return Z(e);s.error(D)},pause:e=>{if(t)return void s.error(D);Ae(e);const r=de();if(e){const t=se(e);t&&ae({...t,status:"paused"})}else r.forEach((e=>{e&&ae({...e,status:"paused"})}))},resume:e=>{if(t)return void s.error(D);we(e);const r=de();if(e){const t=se(e);t&&ae({...t,status:"active"})}else r.forEach((e=>{e&&ae({...e,status:"active"})}))},hasChanged:(e,r)=>t?(s.error(D),!1):ee(e,r),getPreviousPayload:e=>{if(!t)return te(e);s.error(D)},getBreathingState:()=>B.get().breathing,getPerformanceState:()=>{const e=B.get();return{totalProcessingTime:0,totalCallTime:0,totalStress:e.stress.combined,stress:e.stress.combined}},getMetrics:e=>t?{hibernating:!0,activeFormations:0,inRecuperation:!1,breathing:B.get().breathing,formations:[]}:{hibernating:!1,activeFormations:ue().length,inRecuperation:!1,breathing:B.get().breathing,formations:de().filter((t=>t.id===e)).map((e=>({...e,breathingSync:1})))}}},ke=Re("quantum-inceptions");ke.initialize(),e.Cyre=Re,e.CyreLog=s,e.cyre=ke,e.debounce=(e,t)=>{let r,i;const o=(...o)=>{i=o,clearTimeout(r),r=setTimeout((()=>e(...i)),t)};return o.cancel=()=>{clearTimeout(r)},o},e.default="./app",e.isEqual=d,e.memoize=l,e.pipe=c,e.throttle=(e,t)=>{let r,i=null,o=0;const n=(...n)=>{r=n;const a=Date.now();o&&a<o+t?null===i&&(i=setTimeout((()=>{o=Date.now(),i=null,e(...r)}),t)):(o=a,e(...n))};return n.cancel=()=>{i&&(clearTimeout(i),i=null)},n},e.tryCatch=async e=>{try{return{kind:"ok",value:await e()}}catch(t){return{kind:"error",error:t instanceof Error?t:new Error(String(t))}}},e.version="3.1.2",Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}(t.exports)),t.exports}var i=r();const o={REFRESH_CAROUSEL:"refresh_carousel",REFRESH_SCREEN:"refresh_screen",SNAP_TO_POSITION:"snap_to_position",SNAP:"snap",SHAKE:"shake",STATE_UPDATED:"state_updated",STATE_BATCH_UPDATE:"state_batch_update",ANIMATE_FORWARD:"animate_forward",ANIMATE_BACKWARD:"animate_backward",NEXT_SLIDE:"next_slide",PREV_SLIDE:"prev_slide",FIRST_SLIDE:"first_slide",LAST_SLIDE:"last_slide",ACTIVATE:"activate",BRING_TO_FOCUS:"bring_to_focus",WHEELER:"wheeler",ANIMATION_START:"animation_start",ANIMATION_CALCULATE:"animation_calculate",ANIMATION_VALIDATE:"animation_validate",ANIMATION_APPLY:"animation_apply",ANIMATION_SCHEDULE:"animation_schedule",PERFORMANCE_MONITOR:"performance_monitor",PERFORMANCE_OPTIMIZE:"performance_optimize"},n=600,a="cubic-bezier(0.215, 0.61, 0.355, 1)",s={enabled:1,wheel:0,controller:0,drag:1,swipe:1,snap:3,focus:1,animate:1,animateDirection:1,duration:0,loop:200,orientation:0,active:!0,onClick:!0,onDoubleClick:!0},l=e=>({animate:`animate_${e}`,snap:`snap_${e}`,prevSlide:`prev_slide_${e}`,nextSlide:`next_slide_${e}`,lastSlide:`last_slide_${e}`,firstSlide:`first_slide_${e}`,activate:`activate_${e}`,focus:`focus_${e}`,refresh:`refresh_${e}`}),c="holo-carousel",d=(e,t,r)=>{try{i.cyre.call(e,r)}catch(o){console.warn(`Event ${e} failed, falling back to ${t}`);try{i.cyre.call(t,r)}catch(n){console.error(`Both ${e} and ${t} failed:`,n)}}},u={},m=(e,t)=>t?Math.round(e/t)*t:e,h=([e,t])=>{if(!e||!t?.id)return void console.error("activate: Invalid parameters");const r={...t,transformX:-Math.abs(e.offsetLeft)},i=t.eventIds?.snap||`snap_${r.id}`;d(i,o.SNAP,r),e.classList.add("active")},p=e=>{if(!e?.id)return void console.error("prvSlide: Invalid virtual state");if(1===e.endOfSlide)return;const t={...e,transformX:e.transformX+(e.carousel.width||0),transformY:e.transformY+(e.carousel.height||0)},r=e.eventIds?.snap||`snap_${t.id}`;d(r,o.SNAP,t)},f=e=>{if(!e?.id)return void console.error("nxtSlide: Invalid virtual state");if(-1===e.endOfSlide)return;const t={...e,transformX:e.transformX-(e.carousel.width||0),transformY:e.transformY-(e.carousel.height||0)},r=e.eventIds?.snap||`snap_${t.id}`;d(r,o.SNAP,t)},g=e=>{if(!e?.id)return void console.error("firstSlide: Invalid virtual state");const t={...e,transformX:0,transformY:0,endOfSlide:1},r=e.eventIds?.snap||`snap_${t.id}`;d(r,o.SNAP,t)},v=e=>{if(!e?.id)return void console.error("lastSlide: Invalid virtual state");const t={...e,transformX:e.endOfSlidePosition,transformY:e.endOfSlidePosition,endOfSlide:-1},r=e.eventIds?.snap||`snap_${t.id}`;d(r,o.SNAP,t)},y=e=>{if(!e?.id)return void console.error("animateSlideForward: Invalid virtual state");const t=e.eventIds||{firstSlide:`first_slide_${e.id}`,nextSlide:`next_slide_${e.id}`};return-1===e.endOfSlide?d(t.firstSlide,o.FIRST_SLIDE,e):d(t.nextSlide,o.NEXT_SLIDE,e)},E=e=>{if(!e?.id)return void console.error("animateSlideBackward: Invalid virtual state");const t=e.eventIds||{lastSlide:`last_slide_${e.id}`,prevSlide:`prev_slide_${e.id}`};return 1===e.endOfSlide?d(t.lastSlide,o.LAST_SLIDE,e):d(t.prevSlide,o.PREV_SLIDE,e)},S=e=>{const t={...e,transformY:0,transformX:e.io.snap?m(e.transformX,e.item.width||0):e.transformX};return t.transformX>=0?(t.transformX=0,t.endOfSlide=1):t.transformX<=t.endOfSlidePosition?(t.transformX=t.endOfSlidePosition,t.endOfSlide=-1):t.endOfSlide=0,t},I=e=>{const t={...e,transformY:0};return t.transformX>=0?(t.transformX=0,t.endOfSlide=1):t.transformX<=t.endOfSlidePosition?(t.transformX=t.endOfSlidePosition,t.endOfSlide=-1):t.endOfSlide=0,t},T=e=>{const t={...e,transformX:0,transformY:e.io.snap?m(e.transformY,e.item.height||0):e.transformY};return t.transformY>=0?(t.transformY=0,t.endOfSlide=1):t.transformY<=t.endOfSlidePosition?(t.transformY=t.endOfSlidePosition,t.endOfSlide=-1):t.endOfSlide=0,t},b={positionX:0,positionY:0,pressed:0,virtual:{},multiplier:1.5,touch:{start:"mousedown",move:"mousemove",end:"mouseup",enter:"mouseenter"},targetHoloComponent:0,TouchStartTimeStamp:0,id:"",currentX:0,currentY:0,snapShotWidth:0,snapShotHeight:0,distance:0,animationFrameId:0,_touchStart(e,t=""){if(!t)return void console.warn("Touch start: Missing carousel ID");if(this.pressed)return;if(!u[t])return void console.error("Touch start: Invalid carousel ID:",t);this.TouchStartTimeStamp=performance.now(),this.virtual=u[t].getVirtual,this.pressed=1,this.id=this.virtual.id;const r="touches"in e?e.touches[0].clientX:e.clientX,i="touches"in e?e.touches[0].clientY:e.clientY;this.positionX=r,this.positionY=i,this.currentX=r,this.currentY=i,this.snapShotWidth=this.virtual.transformX||0,this.snapShotHeight=this.virtual.transformY||0,this.virtual.io.orientation?this._dragScrollVertical(e):this._dragScrollHorizontal(e),e.preventDefault(),u[this.id]&&(u[this.id].updateStyle=0)},_dragScrollHorizontal(e){if(!this.pressed||!this.id||!u[this.id])return this.cancelDragAnimation(),{ok:!1,data:"Touch not active or invalid state"};this.distance=this.positionX-this.currentX;const t={...this.virtual,transformX:this.snapShotWidth-this.distance*this.multiplier||0},r=I(t);r.transformX!==this.virtual.transformX&&(u[this.id].setState=r,this.virtual=r),this.animationFrameId=requestAnimationFrame((()=>this._dragScrollHorizontal(e)))},_dragScrollVertical(e){if(!this.pressed||!this.id||!u[this.id])return this.cancelDragAnimation(),{ok:!1,data:"Touch not active or invalid state"};this.distance=this.positionY-this.currentY;const t={...this.virtual,transformY:this.snapShotHeight-this.distance*this.multiplier||0},r=T(t);r.transformY!==this.virtual.transformY&&(u[this.id].setState=r,this.virtual=r),this.animationFrameId=requestAnimationFrame((()=>this._dragScrollVertical(e)))},cancelDragAnimation(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=0)},_touchEnd(e){if(this.cancelDragAnimation(),!this.pressed||!this.id||!this.virtual?.id)return{ok:!1,data:"Touch not active or invalid state"};const t=performance.now();e.preventDefault(),this.pressed=0;const r=t-this.TouchStartTimeStamp,i=((e,t)=>t?e/t:0)(this.distance,r),n=this.virtual.eventIds||{};try{u[this.id]&&(u[this.id].updateStyle=1);let t={...this.virtual};if(t.io.snap&&(t=((e,t=!1)=>e.io.orientation?t?(e=>{const t={...e,transformX:0};return t.transformY>=0?(t.transformY=0,t.endOfSlide=1):t.transformY<=t.endOfSlidePosition?(t.transformY=t.endOfSlidePosition,t.endOfSlide=-1):t.endOfSlide=0,t})(e):T(e):t?I(e):S(e))(t,!1)),Math.abs(i)>1.2){const e=i>0?n.nextSlide||o.NEXT_SLIDE:n.prevSlide||o.PREV_SLIDE;d(e,i>0?o.NEXT_SLIDE:o.PREV_SLIDE,t)}else{if((e=>e<250?1:0)(r))return this.focus(e);d(n.snap||`snap_${this.virtual.id}`,o.SNAP,t)}}catch(a){console.error("Touch end error:",a),d(o.SNAP,o.SNAP,this.virtual)}},focus(e){const t=e.target.closest("li.holo");if(!t||!this.id||!this.virtual?.id)return!1;this.targetHoloComponent instanceof HTMLElement&&this.targetHoloComponent.classList.remove("active"),this.targetHoloComponent=t;try{const e=this.virtual.eventIds?.activate||o.ACTIVATE;return d(e,o.ACTIVATE,[this.targetHoloComponent,this.virtual]),!0}catch(r){return console.error("Focus error:",r),this.targetHoloComponent.classList.add("active"),!0}}},A=(e,t)=>{if(!e)return void console.error("IO Manager: Missing virtual state");if(!e.id)return void console.error("IO Manager: Virtual state has no ID");if(!t?.carousel||!t?.container)return void console.error("IO Manager: Invalid shadow DOM references",e.id);const r=(e=>{const t=l(e.id),r={...e,eventIds:t},n=[{id:t.animate,fn:r.io.animateDirection>0?y:E},{id:t.snap,fn:e=>i.cyre.call(o.SNAP,e)},{id:t.prevSlide,fn:p},{id:t.nextSlide,fn:f},{id:t.lastSlide,fn:v},{id:t.firstSlide,fn:g},{id:t.activate,fn:h}];return i.cyre.on(n),i.cyre.action([{id:t.animate,interval:r.io.duration,repeat:r.io.loop,log:!1},{id:t.snap,throttle:50},{id:t.prevSlide},{id:t.nextSlide},{id:t.lastSlide},{id:t.firstSlide},{id:t.activate}]),r})(e);r.io.enabled&&w(r,t),d(o.REFRESH_CAROUSEL,o.REFRESH_CAROUSEL,{virtual:r,shadow:t})},w=(e,t)=>{const r=[];if(e.io.drag){const i=t=>{t.preventDefault(),b._touchStart(t,e.id)};t.container.addEventListener("mousedown",i),r.push((()=>{t.container.removeEventListener("mousedown",i)}))}if(e.io.drag){const i=t=>{t.preventDefault(),b._touchStart(t,e.id)};t.container.addEventListener("touchstart",i,{passive:!1}),r.push((()=>{t.container.removeEventListener("touchstart",i)}))}if(e.io.wheel){const i=t=>{((e,t)=>{if(!t||!u[t]?.getVirtual)return void console.error("wheeler: Invalid carousel ID",t);e.preventDefault();const r=u[t].getVirtual,i=r.eventIds||{prevSlide:`prev_slide_${t}`,nextSlide:`next_slide_${t}`};e.deltaY<0?d(i.prevSlide,o.PREV_SLIDE,r):e.deltaY>0&&d(i.nextSlide,o.NEXT_SLIDE,r)})(t,e.id)};t.carousel.addEventListener("wheel",i,{passive:!1}),r.push((()=>{t.carousel.removeEventListener("wheel",i)}))}e.io.animate&&e.eventIds?.animate&&i.cyre.call(e.eventIds.animate,e);const n=new ResizeObserver(_((()=>{d(o.REFRESH_CAROUSEL,o.REFRESH_CAROUSEL,{virtual:e,shadow:t})}),100));return n.observe(t.carousel),r.push((()=>n.disconnect())),()=>r.forEach((e=>e()))},_=(e,t)=>{let r=!1;return function(...i){r||(e.apply(this,i),r=!0,setTimeout((()=>r=!1),t))}},O=(e="")=>({...s,id:e}),R=(e,t={})=>{const r=e.id||`holo-${Date.now()}`;e.id=r;const o=e.getElementsByClassName("holo-container")[0];if(!o)throw console.error("@Holo: holo-container not found in:",r),new Error("Missing holo-container element");const s={carousel:e,container:o},c=((e="")=>({id:e,carousel:{},container:{},io:O(e),title:null,description:null,duration:n,transitionTiming:a,transformX:0,transformY:0,transformZ:0,numberOfSlots:0,endOfSlide:0,endOfSlidePosition:0,item:{max:8,width:0,height:0,min:1},noOfChildren:0,startNumber:0,eventIds:l(e)}))(r);c.io={...c.io,...t,id:r};const d=s.carousel.clientWidth||0,u=s.carousel.clientHeight||0,m=s.container.clientWidth||0,h=s.container.clientHeight||0,p=s.container.children.length||0,f={...c,carousel:{width:d,height:u},container:{width:m,height:h},noOfChildren:p,startNumber:0,endOfSlidePosition:c.io.orientation?-Math.max(0,h-u):-Math.max(0,m-d)},g=`state_updated_${r}`;i.cyre.on(g,(e=>{})),i.cyre.action({id:g,throttle:16,detectChanges:!0});return{virtual:f,shadow:s,get getVirtual(){return{...this.virtual}},get getShadow(){return this.shadow},get getState(){return{virtual:this.getVirtual,shadow:this.getShadow}},get getDimensions(){return{car:{w:this.shadow.carousel.clientWidth||0,h:this.shadow.carousel.clientHeight||0},con:{w:this.shadow.container.clientWidth||0,h:this.shadow.container.clientHeight||0,x:this.virtual.transformX,y:this.virtual.transformY,z:this.virtual.transformZ}}},set setState(e){e&&(this.virtual={...this.virtual,...e},this.updateDOMTransform(),i.cyre.call(`state_updated_${r}`,this.virtual))},set setDimension(e){e&&(this.virtual={...this.virtual,...e},this.updateDOMDimensions())},set updateStyle(e){this.updateTransitionStyle(1===e)},updateDOMTransform(){this.shadow.container&&(this.shadow.container.style.transform=`translate3d(${this.virtual.transformX}px, ${this.virtual.transformY}px, ${this.virtual.transformZ}px)`)},updateDOMDimensions(){this.shadow.carousel&&(this.virtual.io.orientation?this.shadow.carousel.style.height=`${this.virtual.carousel.height}px`:this.shadow.carousel.style.width=`${this.virtual.carousel.width}px`)},updateTransitionStyle(e){this.shadow.container&&(e?(this.shadow.container.style.transitionDuration=`${this.virtual.duration}ms`,this.shadow.container.style.transitionTimingFunction=this.virtual.transitionTiming):(this.shadow.container.style.transitionDuration="0ms",this.shadow.container.style.transitionTimingFunction="linear"))}}},k=(e,t={})=>{if(e&&e.nodeType){e.id||(e.id=`holo-${Date.now()}`);try{u[e.id]=R(e,t),A(u[e.id].getVirtual,u[e.id].getShadow),console.log("@Holo: Created carousel:",e.id)}catch(r){console.error("@Holo: Failed to create carousel:",r)}}else console.error("@Holo: Invalid DOM element provided")},D=(e="holo-carousel")=>{console.log("@holo holo auto activated:",e);const t=document.getElementsByClassName(e);0!==t.length?Array.from(t).forEach((e=>{k(e,{})})):console.log("@Holo: carousel structure not found")},C=(e,t,r)=>{const i=Math.floor(e/t)||1;return r?Math.min(i,r):i};return(()=>{(()=>{const e=[{id:o.ANIMATE_FORWARD,fn:y},{id:o.ANIMATE_BACKWARD,fn:E},{id:o.NEXT_SLIDE,fn:f},{id:o.PREV_SLIDE,fn:p},{id:o.FIRST_SLIDE,fn:g},{id:o.LAST_SLIDE,fn:v},{id:o.ACTIVATE,fn:h}];i.cyre.on(e);const t=e.map((({id:e})=>({id:e})));i.cyre.action(t)})(),i.cyre.on(o.REFRESH_CAROUSEL,(e=>{const{virtual:t,shadow:r}=e;if(!t?.id||!r?.container)return void console.error("Holo carousel refresh error:",t?.id);r.container.setAttribute("style","");const i=r.container.children[0],{height:n=0,width:a=0}=i?(e=>{if(!e)return{width:0,height:0};const t={width:e.offsetWidth,height:e.offsetHeight};try{const r=window.getComputedStyle(e,null),i=parseInt(r.marginLeft)||0,o=parseInt(r.marginRight)||0,n=parseInt(r.marginTop)||0,a=parseInt(r.marginBottom)||0;t.width+=i+o,t.height+=n+a}catch(r){console.warn("Error calculating element dimensions:",r)}return t})(i):{height:0,width:0},s=r.carousel.parentNode?.clientWidth||0,l={...t,item:{...t.item,height:n,width:a},numberOfSlots:C(s,a,t.item.max)},c=l.numberOfSlots*l.item.width,m=r.carousel.clientWidth,h=r.container.children.length*l.item.width,p=r.container.clientWidth||h,f={...l,carousel:{width:c||m,height:l.item.height||r.carousel.clientHeight},container:{width:l.io.orientation?r.carousel.width:p,height:r.container.clientHeight||l.item.height||0}};return f.endOfSlidePosition=f.io.orientation?-Math.abs((f.container.height||0)-(f.carousel.height||0)):-Math.abs((f.container.width||0)-(f.carousel.width||0)),u[t.id].setDimension={...f},d(o.SNAP_TO_POSITION,o.SNAP,f)})),i.cyre.on(o.SNAP,(e=>{if(!e?.id||!u[e.id])return void console.error("Holo snap error: Invalid state");u[e.id].updateStyle=1;const t=e.io.orientation?T(e):S(e);u[e.id].setState={...t}})),i.cyre.on(o.SNAP_TO_POSITION,(e=>d(o.SNAP,o.SNAP,e))),i.cyre.action([{id:o.REFRESH_CAROUSEL,throttle:100},{id:o.REFRESH_SCREEN,throttle:100},{id:o.SNAP_TO_POSITION,throttle:50},{id:o.SNAP,throttle:50}]);const e=()=>{Object.keys(u).forEach((e=>{if(u[e])try{d(o.REFRESH_CAROUSEL,o.REFRESH_CAROUSEL,u[e].getState)}catch(t){console.error(`Error refreshing carousel ${e}:`,t)}}))},t=(()=>{let e=null;return()=>{null===e&&(e=window.setTimeout((()=>{e=null,d(o.REFRESH_SCREEN,o.REFRESH_SCREEN,null)}),100))}})();return window.addEventListener("resize",t,{passive:!0}),{TOUCH:b,INIT:(t=c)=>{console.log("%c HOLO - Initiating holo v3.0.0 ","background: #022d5f; color: white; display: block;"),(()=>{const e=e=>{b.pressed&&b._touchEnd(e)};document.addEventListener("mousemove",(e=>{b.pressed&&(b.currentX=e.clientX,b.currentY=e.clientY)}),{passive:!0}),document.addEventListener("mouseup",(e=>{b.pressed&&b._touchEnd(e)})),document.addEventListener("touchmove",(e=>{b.pressed&&(b.currentX=e.touches[0].clientX,b.currentY=e.touches[0].clientY,e.preventDefault())}),{passive:!1}),document.addEventListener("touchend",e),document.addEventListener("touchcancel",e)})(),i.cyre.on(o.REFRESH_SCREEN,e),D(t)},BUILD:k,AUTO:D,carousel:(e,t={})=>e&&u[e]?(((e,t)=>{if(!e||!e.virtual)return console.error("@Holo: Cannot update invalid instance"),e;const r=Object.entries(t).reduce(((t,[r,i])=>r in e.virtual.io?{...t,[r]:i}:(console.warn("@Holo: unknown carousel parameter:",r),t)),{}),i={...e.virtual.io,...r};e.setState={...e.getVirtual,io:i}})(u[e],t),{ok:!0,data:u[e].getVirtual.io}):(console.error("updateCarouselOptions: Invalid carousel ID",e),{ok:!1,data:{}}),refresh:e,dimensions:e=>e&&u[e]?u[e].getDimensions:(console.error("getCarouselDimensions: Invalid carousel ID",e),null),EVENTS:o}})()}));
//# sourceMappingURL=holo.js.map
